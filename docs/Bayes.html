<!DOCTYPE html>
<html lang="fr-FR"><head>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/tabby.min.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.4.549">

  <meta name="author" content="Lionel RIOU FRANÇA">
  <title>Statistique Bayésienne</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #f8f8f2; background-color: #282a36; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #f8f8f2; } /* Normal */
    code span.al { color: #ff5555; font-weight: bold; } /* Alert */
    code span.an { color: #ff79c6; } /* Annotation */
    code span.at { color: #ff79c6; } /* Attribute */
    code span.bn { color: #bd93f9; } /* BaseN */
    code span.bu { color: #8be9fd; } /* BuiltIn */
    code span.cf { color: #ff79c6; } /* ControlFlow */
    code span.ch { color: #f1fa8c; } /* Char */
    code span.cn { color: #bd93f9; font-weight: bold; } /* Constant */
    code span.co { color: #6272a4; } /* Comment */
    code span.cv { color: #8be9fd; } /* CommentVar */
    code span.do { color: #ffb86c; } /* Documentation */
    code span.dt { color: #8be9fd; font-style: italic; } /* DataType */
    code span.dv { color: #bd93f9; } /* DecVal */
    code span.er { color: #ff5555; text-decoration: underline; } /* Error */
    code span.ex { color: #8be9fd; } /* Extension */
    code span.fl { color: #bd93f9; } /* Float */
    code span.fu { color: #50fa7b; } /* Function */
    code span.im { color: #ff79c6; } /* Import */
    code span.in { color: #f1fa8c; } /* Information */
    code span.kw { color: #ff79c6; } /* Keyword */
    code span.op { color: #f8f8f2; } /* Operator */
    code span.ot { color: #50fa7b; } /* Other */
    code span.pp { color: #ff79c6; } /* Preprocessor */
    code span.re { color: #8be9fd; } /* RegionMarker */
    code span.sc { color: #ff79c6; } /* SpecialChar */
    code span.ss { color: #f1fa8c; } /* SpecialString */
    code span.st { color: #f1fa8c; } /* String */
    code span.va { color: #8be9fd; } /* Variable */
    code span.vs { color: #f1fa8c; } /* VerbatimString */
    code span.wa { color: #ff5555; } /* Warning */
  </style>
  <link rel="stylesheet" href="site_libs/revealjs/dist/theme/quarto.css">
  <link href="site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    padding-bottom: 0.5rem;
    margin-bottom: 0;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Statistique Bayésienne</h1>
  <p class="subtitle">Une Introduction</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Lionel RIOU FRANÇA 
</div>
        <p class="quarto-title-affiliation">
            Aixial Group
          </p>
    </div>
</div>

  <p class="date">23 février 2024</p>
</section>
<section id="liens-dintérêt" class="slide level2">
<h2>Liens d’intérêt</h2>
<p><br>
<br>
Depuis Mars 2023, Lionel Riou França est employé par Aixial Group.</p>
<p><br>
Les opinions exprimées dans cette présentation n’engagent que l’orateur. Elles ne correspondent pas nécessairement à celles d’Aixial Group.</p>
</section>
<section>
<section id="probabilité" class="title-slide slide level1 center">
<h1>Probabilité</h1>

</section>
<section id="la-probabilité-définition-fréquentiste" class="slide level2">
<h2>La Probabilité : Définition fréquentiste</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="callout callout-note no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong><span class="math inline">\(P(X=s)\)</span></strong></p>
</div>
<div class="callout-content">
<p>Proportion de patients guéris sur une infinité de patients traités.</p>
<p><span class="math display">\[P(X=s)=\frac{\textrm{Nombre guéris}}{\textrm{Nombre traités}}\]</span></p>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><a href="Bayes_files/figure-revealjs/ProbFreq-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img data-src="Bayes_files/figure-revealjs/ProbFreq-1.png" width="576"></a></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="la-probabilité-approche-bayésienne" class="slide level2">
<h2>La Probabilité : Approche bayésienne</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><a href="Bayes_files/img/idea.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img data-src="Bayes_files/img/idea.svg" class="no-lightbox" style="width:85.0%"></a></p>
</div><div class="column" style="width:50%;">
<ul>
<li>Probabilité objective d’un événement n’existe pas</li>
<li>Probabilité = Croyance subjective</li>
<li>Mesure d’incertitude</li>
<li>Obéit aux axiomes du calcul des probabilités</li>
</ul>
</div>
</div>
</section>
<section id="probabilités-conditionnelles-test-de-dépistage" class="slide level2">
<h2>Probabilités conditionnelles : test de dépistage</h2>
<ul>
<li>Mammographie et cancer du sein
<ul>
<li>Sensibilité = 75 % = <span class="math inline">\(P\left(T^+ | M^+ \right)\)</span></li>
<li>Spécificité = 99 % = <span class="math inline">\(P\left(T^- | M^- \right)\)</span></li>
</ul></li>
<li>Prévalence du cancer dans la population dépistée : 3 ‰</li>
</ul>
<div class="fragment">
<p>Lors d’un dépistage, le test est positif.</p>
<p>Probabilité d’avoir un cancer (<span class="fragment highlight-blue">Valeur Prédictive Positive</span>) ?</p>
</div>
</section>
<section id="probabilités-conditionnelles-test-de-dépistage-1" class="slide level2" data-transition="none">
<h2>Probabilités conditionnelles : test de dépistage</h2>
<p>Supposons une population de <span style="color:#ED4F33">4 000</span> personnes</p>
<table>
<colgroup>
<col style="width: 31%">
<col style="width: 25%">
<col style="width: 23%">
<col style="width: 21%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th style="text-align: right;">M+ (Malade)</th>
<th style="text-align: right;">M- (Sain)</th>
<th style="text-align: right;">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>T+ (Test positif)</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td>T- (Test négatif)</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td>Total</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"><span style="color:#ED4F33">4 000</span></td>
</tr>
</tbody>
</table>
</section>
<section id="probabilités-conditionnelles-test-de-dépistage-2" class="slide level2" data-transition="none">
<h2>Probabilités conditionnelles : test de dépistage</h2>
<p>Prévalence : <span style="color:#ED4F33">3 ‰</span></p>
<table>
<colgroup>
<col style="width: 31%">
<col style="width: 25%">
<col style="width: 23%">
<col style="width: 21%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th style="text-align: right;">M+ (Malade)</th>
<th style="text-align: right;">M- (Sain)</th>
<th style="text-align: right;">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>T+ (Test positif)</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td>T- (Test négatif)</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td>Total</td>
<td style="text-align: right;"><span style="color:#ED4F33">12</span></td>
<td style="text-align: right;"><span class="fragment">3988</span></td>
<td style="text-align: right;"><span style="color:#F5B12E">4 000</span></td>
</tr>
</tbody>
</table>

<aside><div>
<p><span class="math inline">\(n_{M^+} = 4000*3/1000 = 12\)</span></p>
</div></aside></section>
<section id="probabilités-conditionnelles-test-de-dépistage-3" class="slide level2" data-transition="none">
<h2>Probabilités conditionnelles : test de dépistage</h2>
<p>Sensibilité <span class="math inline">\(P\left(T^+ | M^+ \right)\)</span> : <span style="color:#ED4F33">75%</span></p>
<table>
<colgroup>
<col style="width: 31%">
<col style="width: 25%">
<col style="width: 23%">
<col style="width: 21%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th style="text-align: right;">M+ (Malade)</th>
<th style="text-align: right;">M- (Sain)</th>
<th style="text-align: right;">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>T+ (Test positif)</td>
<td style="text-align: right;"><span style="color:#ED4F33">9</span></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td>T- (Test négatif)</td>
<td style="text-align: right;"><span class="fragment">3</span></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td>Total</td>
<td style="text-align: right;"><span style="color:#F5B12E">12</span></td>
<td style="text-align: right;">3988</td>
<td style="text-align: right;">4 000</td>
</tr>
</tbody>
</table>

<aside><div>
<p><span class="math inline">\(n_{M^+, T^+} = 12*75/100 = 9\)</span></p>
</div></aside></section>
<section id="probabilités-conditionnelles-test-de-dépistage-4" class="slide level2" data-transition="none">
<h2>Probabilités conditionnelles : test de dépistage</h2>
<p>Spécificité <span class="math inline">\(P\left(T^- | M^- \right)\)</span> : <span style="color:#ED4F33">99%</span></p>
<table>
<colgroup>
<col style="width: 31%">
<col style="width: 25%">
<col style="width: 23%">
<col style="width: 21%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th style="text-align: right;">M+ (Malade)</th>
<th style="text-align: right;">M- (Sain)</th>
<th style="text-align: right;">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>T+ (Test positif)</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;"><span class="fragment">40</span></td>
<td style="text-align: right;"><span class="fragment">49</span></td>
</tr>
<tr class="even">
<td>T- (Test négatif)</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;"><span style="color:#ED4F33">3 948</span></td>
<td style="text-align: right;"><span class="fragment">3 951</span></td>
</tr>
<tr class="odd">
<td>Total</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;"><span style="color:#F5B12E">3 988</span></td>
<td style="text-align: right;">4 000</td>
</tr>
</tbody>
</table>

<aside><div>
<p><span class="math inline">\(n_{M^-, T^-} = (4000-12)*99/100 = 3988*0,99 = 3948\)</span></p>
</div></aside></section>
<section id="théorème-de-bayes" class="slide level2">
<h2>Théorème de Bayes</h2>
<table>
<thead>
<tr class="header">
<th></th>
<th style="text-align: right;">M+ (Malade)</th>
<th style="text-align: right;">M- (Sain)</th>
<th style="text-align: right;">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>T+ (Test positif)</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">49</td>
</tr>
<tr class="even">
<td>T- (Test négatif)</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3 948</td>
<td style="text-align: right;">3 951</td>
</tr>
<tr class="odd">
<td>Total</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">3 988</td>
<td style="text-align: right;">4 000</td>
</tr>
</tbody>
</table>
<p><span class="math display">\[
\begin{align}
P(M^+|T^+)
&amp;= \frac{\color{#ED4F33}{P(T^+ | M^+)} \color{#F5B12E}{P(M^+)}}{\color{#ADD2D8}{P(T^+)}} \\
&amp;\class{fragment}{= \frac{{\color{#ED4F33}{9/12}} * \color{#F5B12E}{12/4000}}{\color{#ADD2D8}{49/4000}}} \class{fragment}{= \frac{9}{49} = 18~\%}
\end{align}
\]</span></p>
</section></section>
<section>
<section id="estimation-approche-fréquentiste" class="title-slide slide level1 center">
<h1>Estimation : approche fréquentiste</h1>

</section>
<section id="efficacité-dun-traitement" class="slide level2">
<h2>Efficacité d’un traitement</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><span class="math inline">\(n=10\)</span> patients traités, <span class="math inline">\(k=7\)</span> guéris</p>
<p>Comment estimer <span class="math inline">\(\theta\)</span>, probabilité de guérison ?</p>
<div class="fragment">
<p><span style="color:#F5B12E"><strong>Estimateur du maximum de vraisemblance (EMV)</strong></span> :</p>
<ul>
<li>Vraisemblance, loi binomiale : <span class="math inline">\(P(D=k) = {n\choose k} \theta^k (1-\theta)^{n-k}\)</span>
<ul>
<li><span style="color:#ADD2D8"><span class="math inline">\({n\choose k} = \frac{n!}{k!(n-k)!}\)</span></span></li>
</ul></li>
<li>EMV=<span class="math inline">\(k/n\)</span> = 0,70</li>
</ul>
</div>
</div><div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="Bayes_files/figure-revealjs/Vraisemblance-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img data-src="Bayes_files/figure-revealjs/Vraisemblance-1.png" class="quarto-figure quarto-figure-center" style="width:90.0%"></a></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section></section>
<section>
<section id="estimation-approche-bayésienne" class="title-slide slide level1 center">
<h1>Estimation : approche Bayésienne</h1>

</section>
<section id="théorème-de-bayes-appliqué-à-des-paramètres" class="slide level2">
<h2>Théorème de Bayes appliqué à des paramètres</h2>
<p><span class="math display">\[
\begin{align}
\color{#2E2963}{\underbrace{P(\theta | D)}}   \ \ \ &amp; = &amp; \color{#ED4F33}{\underbrace{P(D | \theta)}}  \ \ \ \ \  &amp; &amp;  \color{#F5B12E}{\underbrace{P(\theta)}}  \ \ \  &amp; / &amp; \color{#ADD2D8}{\underbrace{P(D)}}  \ \  \\
\color{#2E2963}{\textrm{a posteriori}}      &amp; = &amp; \color{#ED4F33}{\textrm{vraisemblance}} &amp; &amp; \color{#F5B12E}{\textrm{a priori}} \ \  &amp; / &amp; \color{#ADD2D8}{\textrm{données}}
\end{align}
\]</span></p>
<div class="fragment">
<div class="columns">
<div class="column" style="width:50%;">
<p><span class="math inline">\(\theta\)</span> discret</p>
<p><span class="math inline">\(\color{#ADD2D8}{P(D)} = \displaystyle\sum_{\theta} \color{#ED4F33}{P(D|\theta)} \color{#F5B12E}{P(\theta)}\)</span></p>
</div><div class="column" style="width:50%;">
<div class="fragment">
<p><span class="math inline">\(\theta\)</span> continu</p>
<p><span class="math inline">\(\color{#ADD2D8}{P(D)} = \int \color{#ED4F33}{P(D|\theta)} \color{#F5B12E}{P(\theta)} \textrm{d}\theta\)</span></p>
</div>
</div>
</div>
</div>
</section>
<section id="approximation-par-grille" class="slide level2">
<h2>Approximation par grille</h2>
<div>
<ol type="1">
<li class="fragment"><p>Lister un nombre fini de valeurs du/des paramètre(s) <span class="math inline">\(\theta\)</span> à estimer</p></li>
<li class="fragment"><p>Leur donner une probabilité a priori <span class="math inline">\(\color{#F5B12E}{P(\theta)}\)</span></p></li>
<li class="fragment"><p>Calculer la vraisemblance <span class="math inline">\(\color{#ED4F33}{P(D|\theta)}\)</span> des données observées pour chacune des valeurs possibles de <span class="math inline">\(\theta\)</span></p></li>
<li class="fragment"><p>Faire le produit de la vraisemblance et de l’a priori <span class="math inline">\(\color{#ED4F33}{P(D|\theta)}*\color{#F5B12E}{P(\theta)}\)</span> pour chaque valeur de <span class="math inline">\(\theta\)</span></p></li>
<li class="fragment"><p>La somme de ces produits <span class="math inline">\(\sum_\theta \color{#ED4F33}{P(D|\theta)}*\color{#F5B12E}{P(\theta)}\)</span> donne la constante de normalisation <span class="math inline">\(\color{#ADD2D8}{P(D)}\)</span></p></li>
<li class="fragment"><p>En déduire l’a posteriori <span class="math inline">\(\color{#2E2963}{P(\theta | D)} = \frac{\color{#ED4F33}{P(D|\theta)}*\color{#F5B12E}{P(\theta)}}{\color{#ADD2D8}{P(D)}}\)</span> pour les valeurs choisies</p></li>
</ol>
</div>
</section>
<section id="approximation-par-grille-1" class="slide level2 smaller">
<h2>Approximation par grille</h2>
<p><span class="math inline">\(n=10\)</span> patients traités, <span class="math inline">\(k=7\)</span> guéris</p>
<p><span class="math inline">\(\color{#ED4F33}{P(D|\theta)} = P(D=7/10|\theta) = {10\choose 7} \theta^7 (1-\theta)^{3}\)</span></p>
<table class="table-striped">
<colgroup>
<col style="width: 10%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;"><span class="math inline">\(\theta\)</span></th>
<th style="text-align: right;"><span class="math inline">\(\color{#F5B12E}{P(\theta)}\)</span></th>
<th style="text-align: right;"><span class="math inline">\(\color{#ED4F33}{P(D|\theta)}\)</span></th>
<th style="text-align: right;"><span class="math inline">\(\color{#ED4F33}{P(D|\theta)}*\color{#F5B12E}{P(\theta)}\)</span></th>
<th style="text-align: right;"><span class="math inline">\(\color{#2E2963}{P(\theta|D)} = \color{#ED4F33}{P(D|\theta)}*\color{#F5B12E}{P(\theta)} / \color{#ADD2D8}{P(D)}\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0 %</td>
<td style="text-align: right;">1/11=9,1 %</td>
<td style="text-align: right;">0,000 %</td>
<td style="text-align: right;">0,000000</td>
<td style="text-align: right;">0,000 %</td>
</tr>
<tr class="even">
<td style="text-align: right;">…</td>
<td style="text-align: right;">…</td>
<td style="text-align: right;">…</td>
<td style="text-align: right;">…</td>
<td style="text-align: right;">…</td>
</tr>
<tr class="odd">
<td style="text-align: right;">70 %</td>
<td style="text-align: right;">9,1 %</td>
<td style="text-align: right;">26,683 %<sup>1</sup></td>
<td style="text-align: right;">0,024257</td>
<td style="text-align: right;">29,322 %</td>
</tr>
<tr class="even">
<td style="text-align: right;">…</td>
<td style="text-align: right;">…</td>
<td style="text-align: right;">…</td>
<td style="text-align: right;">…</td>
<td style="text-align: right;">…</td>
</tr>
<tr class="odd">
<td style="text-align: right;">100 %</td>
<td style="text-align: right;">9,1 %</td>
<td style="text-align: right;">0,000 %</td>
<td style="text-align: right;">0,000000</td>
<td style="text-align: right;">0,000 %</td>
</tr>
<tr class="even">
<td style="text-align: right;">Somme</td>
<td style="text-align: right;">100 %</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"><span class="math inline">\(\color{#ADD2D8}{P(D)}\)</span> = 0,0827</td>
<td style="text-align: right;">100 %</td>
</tr>
</tbody>
</table>
<p><br>
Estimateur bayésien de <span class="math inline">\(\theta\)</span> (probabilité de guérison) : <span class="math inline">\(E\left[\color{#2E2963}{P(\theta|D)} \right] = \sum_\theta \theta \color{#2E2963}{P(\theta|D)}\)</span> = 67%</p>
<aside><ol class="aside-footnotes"><li id="fn1"><p>Dans R : <code>dbinom(x=7, size=10, prob=0.7)</code></p></li></ol></aside></section>
<section id="estimation-par-lois-conjuguées-loi-de-probabilité-bêta" class="slide level2">
<h2>Estimation par lois conjuguées : loi de probabilité bêta</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><span class="math inline">\(\theta \sim\)</span> beta(a, b), a&gt;0, b&gt;0</p>
<p><img data-src="Bayes_files/img/Rlogo.svg" class="no-lightbox" style="width:5.0%"> <code>dbeta(x,shape1=a,shape2=b)</code></p>
<p><span class="math inline">\(P(\theta | a, b) = \\ \frac{\Gamma(a+b)}{\Gamma(a)\Gamma(b)} \theta^{a-1} (1-\theta)^{b-1} I_{\left\{ 0\leq \theta \leq 1 \right\}}(\theta)\)</span></p>
<p><span class="math inline">\(E(\theta) = \frac{a}{a+b}\)</span></p>
<p>Effective sample size = a+b</p>
<p>Si a&gt;1, b&gt;1, mode : <span class="math inline">\(\frac{a-1}{a+b-2}\)</span></p>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><a href="Bayes_files/figure-revealjs/ExBeta-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img data-src="Bayes_files/figure-revealjs/ExBeta-1.png" style="width:80.0%"></a></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="estimation-bayésienne-dune-proportion-distribution-conjuguée" class="slide level2">
<h2>Estimation bayésienne d’une proportion : distribution conjuguée</h2>
<p>La loi bêta est <em>conjuguée</em> avec une vraisemblance binomiale :</p>
<ul>
<li><p><span class="math inline">\(\color{#F5B12E}{P(\theta) \sim \textrm{beta}(a,b)}\)</span></p></li>
<li><p><span class="math inline">\(\color{#ED4F33}{P(D|\theta) \sim \textrm{binom}(n,\theta)}\)</span> avec <span class="math inline">\(k\)</span> succès</p></li>
<li><p><span class="math inline">\(\color{#2E2963}{P(\theta|D) \sim \textrm{beta}(} \color{#ED4F33}{k}+\color{#F5B12E}{a},\color{#ED4F33}{(n-k)}+\color{#F5B12E}{b}\color{#2E2963}{)}\)</span></p></li>
</ul>
<div class="fragment">
<p><span id="2E2963">a posteriori</span> : compromis entre <span style="color:#F5B12E">a priori</span> et <span style="color:#ED4F33">vraisemblance</span></p>
</div>
</section>
<section id="estimation-bayésienne-dune-proportion-distribution-conjuguée-1" class="slide level2">
<h2>Estimation bayésienne d’une proportion : distribution conjuguée</h2>
<div class="columns">
<div class="column" style="width:33%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><a href="Bayes_files/figure-revealjs/ConjugHaldane-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img data-src="Bayes_files/figure-revealjs/ConjugHaldane-1.png" style="width:90.0%"></a></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:33%;">
<div class="fragment">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><a href="Bayes_files/figure-revealjs/ConjugUnif-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6"><img data-src="Bayes_files/figure-revealjs/ConjugUnif-1.png" style="width:90.0%"></a></p>
</figure>
</div>
</div>
</div>
</div>
</div><div class="column" style="width:33%;">
<div class="fragment">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><a href="Bayes_files/figure-revealjs/ConjugInfo-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7"><img data-src="Bayes_files/figure-revealjs/ConjugInfo-1.png" style="width:90.0%"></a></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="intervalles-de-crédibilité" class="slide level2 smaller">
<h2>Intervalles de crédibilité</h2>
<p><span class="math inline">\((i,s)\)</span> tel que <span class="math inline">\(\theta\)</span> a <span class="math inline">\((1-\alpha)\)</span> % de chances d’être compris dans l’intervalle</p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><a href="Bayes_files/figure-revealjs/HDI-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8"><img data-src="Bayes_files/figure-revealjs/HDI-1.png" style="width:90.0%"></a></p>
</figure>
</div>
</div>
</div>
<p><strong>Highest Density Interval</strong> (HDI/HPD) : Largeur minimale</p>
</div><div class="column" style="width:50%;">
<div class="fragment">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><a href="Bayes_files/figure-revealjs/ETI-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9"><img data-src="Bayes_files/figure-revealjs/ETI-1.png" style="width:90.0%"></a></p>
</figure>
</div>
</div>
</div>
<p><strong>Equal-tailed Interval</strong> : défini par les quantiles (e.g.&nbsp;2.5 % et 97.5 %) de la distribution</p>
</div>
</div>
</div>
</section></section>
<section>
<section id="estimation-bayésienne-par-markov-chain-monte-carlo-mcmc" class="title-slide slide level1 center">
<h1>Estimation Bayésienne par Markov Chain Monte Carlo (MCMC)</h1>

</section>
<section id="mcmc-markov-chain-monte-carlo" class="slide level2">
<h2>MCMC : Markov Chain Monte Carlo</h2>
<dl>
<dt>Monte Carlo</dt>
<dd>
<p>car estimation d’une grandeur complexe (intégrale) par <span style="color:#ED4F33">simulation</span>.</p>
</dd>
<dt>Markov Chain</dt>
<dd>
<p>car l’état du système au temps <span class="math inline">\(t\)</span> ne dépend que de <span class="math inline">\(t-1\)</span>.</p>
</dd>
</dl>
<p>L’algorithme de Metropolis-Hastings ou l’échantillonage de Gibbs garantissent la <span style="color:#ED4F33">convergence</span> vers la distribution cible après un temps de chauffe (“<span style="color:#F5B12E">burn-in</span>”)</p>
</section>
<section id="algorithme-de-metropolis-hastings-version-simple" class="slide level2">
<h2>Algorithme de Metropolis-Hastings (version simple)</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="callout callout-note no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Inférence Bayésienne</strong></p>
</div>
<div class="callout-content">
<p><span class="math display">\[\color{#2E2963}{P(\theta|D)} = \frac{\color{#ED4F33}{P(D|\theta)} \color{#F5B12E}{P(\theta)}}{\color{#ADD2D8}{\int P(D|\theta) P(\theta) \textrm{d}\theta}}\]</span></p>
</div>
</div>
</div>
<p>Comment estimer des intégrales complexes?</p>
</div><div class="column" style="width:60%;">
<p>But : estimer <span class="math inline">\(f(\theta)\)</span>, à partir d’une forme + simple <span class="math inline">\(g(\theta) \propto f(\theta)\)</span>.</p>
<ul>
<li><p>Départ de <span class="math inline">\(\theta_0\)</span></p></li>
<li><p>Tirer <span class="math inline">\(\theta^* \sim \textrm{N}\left(\theta_{\textrm{actuel}},\sigma^2\right)\)</span></p></li>
<li><p>Adopter <span class="math inline">\(\theta^*\)</span> avec probabilité <span class="math inline">\(\min \left(1, \frac{g(\theta^*)}{g(\theta_{\textrm{actuel}})}\right)\)</span></p></li>
</ul>
<p>Cette chaîne de Markov convergera vers la distribution cible <span class="math inline">\(f(\theta)\)</span>.</p>
</div>
</div>
</section>
<section id="application-probabilité-de-guérison" class="slide level2">
<h2>Application : probabilité de guérison</h2>
<p><span class="math display">\[
\begin{align}
f(\theta) = \color{#2E2963}{P(\theta | D)}
&amp;\propto \color{#ED4F33}{P(D | \theta)} \color{#F5B12E}{P(\theta)} \\
&amp;\propto \color{#ED4F33}{\theta^k(1-\theta)^{n-k}} \color{#F5B12E}{\theta^{a-1}(1-\theta)^{b-1}} \\
&amp;\propto \theta^{k+a-1}(1-\theta)^{n-k+b-1}
\end{align}
\]</span> Données : n=10 patients, k=7 guérisons.</p>
<p>A priori uniforme beta(1,1).</p>
<p><span class="math display">\[g(\theta) = \theta^7 (1-\theta)^3 \textrm{I}_{0 \leq \theta \leq 1}(\theta)\]</span></p>
</section>
<section id="programation-dans" class="slide level2">
<h2>Programation dans <img data-src="Bayes_files/img/Rlogo.svg" class="no-lightbox" style="width:7.0%"></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a></a><span class="co"># Programmation de g</span></span>
<span id="cb1-2"><a></a>g <span class="ot">&lt;-</span> <span class="cf">function</span>(theta) {</span>
<span id="cb1-3"><a></a>      theta<span class="sc">^</span><span class="dv">7</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>theta)<span class="sc">^</span><span class="dv">3</span><span class="sc">*</span>(theta<span class="sc">&gt;=</span><span class="dv">0</span> <span class="sc">&amp;</span> theta<span class="sc">&lt;=</span><span class="dv">1</span>)</span>
<span id="cb1-4"><a></a>}</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="programation-dans-1" class="slide level2">
<h2>Programation dans <img data-src="Bayes_files/img/Rlogo.svg" class="no-lightbox" style="width:7.0%"></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a></a><span class="co"># Algorithme de Metropolis-Hastings</span></span>
<span id="cb2-2"><a></a>mh <span class="ot">&lt;-</span> <span class="cf">function</span>(nIter,thetaInit,candSD) {</span>
<span id="cb2-3"><a></a>  <span class="co"># Initialisation</span></span>
<span id="cb2-4"><a></a>  thetaOut <span class="ot">&lt;-</span> <span class="fu">numeric</span>(nIter) ; accept <span class="ot">&lt;-</span> <span class="dv">0</span> </span>
<span id="cb2-5"><a></a>  thetaActuel <span class="ot">&lt;-</span> thetaInit ; gActuel <span class="ot">&lt;-</span> <span class="fu">g</span>(thetaActuel)</span>
<span id="cb2-6"><a></a>  <span class="co"># Itérations</span></span>
<span id="cb2-7"><a></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nIter) {</span>
<span id="cb2-8"><a></a>    thetaCand <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n=</span><span class="dv">1</span>,<span class="at">mean=</span>thetaActuel,<span class="at">sd=</span>candSD) <span class="co"># Tirer 1 candidat</span></span>
<span id="cb2-9"><a></a>    gCand <span class="ot">&lt;-</span> <span class="fu">g</span>(<span class="at">theta=</span>thetaCand) <span class="co"># Evaluer g avec le candidat</span></span>
<span id="cb2-10"><a></a>    ratio <span class="ot">&lt;-</span> gCand<span class="sc">/</span>gActuel <span class="co"># Ratio</span></span>
<span id="cb2-11"><a></a>    u <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">n=</span><span class="dv">1</span>) <span class="co"># u sera inf à ratio avec probabilité=ratio</span></span>
<span id="cb2-12"><a></a>    <span class="cf">if</span> (u<span class="sc">&lt;</span>ratio){ <span class="co"># alors candidat accepté</span></span>
<span id="cb2-13"><a></a>      thetaActuel <span class="ot">&lt;-</span> thetaCand ; gActuel <span class="ot">&lt;-</span> gCand</span>
<span id="cb2-14"><a></a>      accept <span class="ot">&lt;-</span> accept<span class="sc">+</span><span class="dv">1</span> <span class="co"># monitorer combien de candidats sont acceptés</span></span>
<span id="cb2-15"><a></a>      }</span>
<span id="cb2-16"><a></a>    <span class="co"># Collecter les résultats</span></span>
<span id="cb2-17"><a></a>    thetaOut[i] <span class="ot">&lt;-</span> thetaActuel</span>
<span id="cb2-18"><a></a>    }</span>
<span id="cb2-19"><a></a>  <span class="fu">list</span>(<span class="at">theta=</span>thetaOut,<span class="at">accept=</span>accept<span class="sc">/</span>nIter)</span>
<span id="cb2-20"><a></a>}</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="application-écart-type-inapproprié" class="slide level2">
<h2>Application : Écart-type inapproprié</h2>
<p><strong>Trop faible</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a></a>simul1 <span class="ot">&lt;-</span> <span class="fu">mh</span>(<span class="at">nIter =</span> <span class="dv">10000</span>, <span class="at">thetaInit =</span> <span class="fl">0.01</span>, <span class="at">candSD =</span> <span class="fl">0.02</span>)</span>
<span id="cb3-2"><a></a>simul1<span class="sc">$</span>accept <span class="co"># La plupart des propositions sont acceptées</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9511</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a></a><span class="fu">summary</span>(simul1<span class="sc">$</span>theta)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
0.05232 0.55573 0.67106 0.64950 0.75470 0.96494 </code></pre>
</div>
</div>
<div class="fragment">
<p><strong>Trop élevé</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a></a>simul2 <span class="ot">&lt;-</span> <span class="fu">mh</span>(<span class="at">nIter =</span> <span class="dv">10000</span>, <span class="at">thetaInit =</span> <span class="fl">0.01</span>, <span class="at">candSD =</span> <span class="fl">2.00</span>)</span>
<span id="cb7-2"><a></a>simul2<span class="sc">$</span>accept <span class="co"># La plupart des propositions sont rejetées</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0828</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a></a><span class="fu">summary</span>(simul2<span class="sc">$</span>theta)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.0100  0.5854  0.6612  0.6670  0.7627  0.9605 </code></pre>
</div>
</div>
</div>
</section>
<section id="trace-plots" class="slide level2">
<h2>Trace plots</h2>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><a href="Bayes_files/figure-revealjs/TraceplotsSmallBig-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10"><img data-src="Bayes_files/figure-revealjs/TraceplotsSmallBig-1.png" style="width:95.0%"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="écart-type-approprié" class="slide level2">
<h2>Écart-type approprié</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a></a>simul3 <span class="ot">&lt;-</span> <span class="fu">mh</span>(<span class="at">nIter =</span> <span class="dv">10000</span>, <span class="at">thetaInit =</span> <span class="fl">0.01</span>, <span class="at">candSD =</span> <span class="fl">0.30</span>)</span>
<span id="cb11-2"><a></a>simul3<span class="sc">$</span>accept <span class="co"># Environ 50 % des propositions sont acceptées</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4652</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a></a><span class="fu">summary</span>(simul3<span class="sc">$</span>theta)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.1813  0.5802  0.6747  0.6653  0.7612  0.9750 </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><a href="Bayes_files/figure-revealjs/TraceplotsGood-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-11"><img data-src="Bayes_files/figure-revealjs/TraceplotsGood-1.png" style="width:95.0%"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="distribution-a-posteriori" class="slide level2">
<h2>Distribution a posteriori</h2>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><a href="Bayes_files/figure-revealjs/MetroHastHist-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-12"><img data-src="Bayes_files/figure-revealjs/MetroHastHist-1.png" style="width:95.0%"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="échantillonage-de-gibbs" class="slide level2">
<h2>Échantillonage de Gibbs</h2>
<p>Plusieurs paramètres <span class="math inline">\(\theta_i\)</span> à estimer: Metropolis-Hastings inefficient (ou difficultés à connaître la distribution complète)</p>
<p>Alternative : Gibbs</p>
<ul>
<li><p>Échantillonnage alterné des <span class="math inline">\(\theta_i\)</span> à partir de <span class="math inline">\(P\left( \theta_i | \theta_{j \neq i, D} \right)\)</span></p></li>
<li><p>Exemple : paramètres <span class="math inline">\(\mu\)</span> et <span class="math inline">\(\sigma\)</span> d’une loi normale</p>
<ul>
<li><p>au temps <span class="math inline">\(t\)</span>, tirer <span class="math inline">\(\mu^t\)</span> à partir de <span class="math inline">\(P\left( \mu | \sigma^{\color{#ED4F33}{t-1}}, D \right)\)</span></p></li>
<li><p>puis tirer <span class="math inline">\(\sigma^t\)</span> à partir de <span class="math inline">\(P\left( \sigma | \mu^{\color{#ED4F33}{t}}, D \right)\)</span></p></li>
</ul></li>
</ul>
</section></section>
<section>
<section id="diagnostics-mcmc" class="title-slide slide level1 center">
<h1>Diagnostics MCMC</h1>

</section>
<section id="vérification-de-la-convergence" class="slide level2">
<h2>Vérification de la convergence</h2>
<p>MCMC : convergence avec <span class="math inline">\(n=\infty\)</span> itérations.</p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="callout callout-note no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Diagnostic de <strong>convergence</strong></strong></p>
</div>
<div class="callout-content">
<ul>
<li><p>Graphiquement : trace plots, chaînes multiples</p></li>
<li><p>Indicateurs numériques : Gelman &amp; Rubin</p></li>
</ul>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="callout callout-note no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Diagnostic de <strong>précision/stabilité</strong></strong></p>
</div>
<div class="callout-content">
<ul>
<li><p>Graphiquement : trace plots, chaînes multiples</p></li>
<li><p>Indicateurs numériques : autocorrélation, <em>effective sample size</em>, Raftery &amp; Lewis</p></li>
</ul>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="trace-plots-distribution-non-stationnaire" class="slide level2">
<h2>Trace plots &amp; distribution non stationnaire</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a></a><span class="co"># itérations avec écart-type trop faible</span></span>
<span id="cb15-2"><a></a>chaine1 <span class="ot">&lt;-</span> <span class="fu">mh</span>(<span class="at">nIter =</span> <span class="dv">500</span>, <span class="at">thetaInit =</span> <span class="fl">0.01</span>, <span class="at">candSD =</span> <span class="fl">0.015</span>)<span class="sc">$</span>theta</span>
<span id="cb15-3"><a></a>chaine2 <span class="ot">&lt;-</span> <span class="fu">mh</span>(<span class="at">nIter =</span> <span class="dv">500</span>, <span class="at">thetaInit =</span> <span class="fl">0.99</span>, <span class="at">candSD =</span> <span class="fl">0.015</span>)<span class="sc">$</span>theta</span>
<span id="cb15-4"><a></a>chaine3 <span class="ot">&lt;-</span> <span class="fu">mh</span>(<span class="at">nIter =</span> <span class="dv">500</span>, <span class="at">thetaInit =</span> <span class="fl">0.50</span>, <span class="at">candSD =</span> <span class="fl">0.015</span>)<span class="sc">$</span>theta</span>
<span id="cb15-5"><a></a></span>
<span id="cb15-6"><a></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb15-7"><a></a><span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb15-8"><a></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">500</span>,<span class="at">y=</span>chaine1), <span class="at">color=</span><span class="dv">1</span>, <span class="at">linewidth=</span><span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb15-9"><a></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">500</span>,<span class="at">y=</span>chaine2), <span class="at">color=</span><span class="dv">2</span>, <span class="at">linewidth=</span><span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb15-10"><a></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">500</span>,<span class="at">y=</span>chaine3), <span class="at">color=</span><span class="dv">3</span>, <span class="at">linewidth=</span><span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb15-11"><a></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Itération"</span>, <span class="at">y=</span><span class="fu">expression</span>(theta)) <span class="sc">+</span></span>
<span id="cb15-12"><a></a>  <span class="fu">theme_grey</span>(<span class="at">base_size=</span><span class="dv">25</span>) </span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>

</section>
<section id="trace-plots-distribution-non-stationnaire-output" class="slide level2 output-location-slide"><h2>Trace plots &amp; distribution non stationnaire</h2><div class="cell output-location-slide">
<div class="cell-output-display">
<div>
<figure>
<p><a href="Bayes_files/figure-revealjs/TraceplotsConvergence-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-13"><img data-src="Bayes_files/figure-revealjs/TraceplotsConvergence-1.png" style="width:95.0%"></a></p>
</figure>
</div>
</div>
</div></section><section id="diagnostic-de-gelman-rubin" class="slide level2">
<h2>Diagnostic de Gelman &amp; Rubin</h2>
<div class="columns">
<div class="column" style="width:20%;">
<p><a href="Bayes_files/img/diagnosis.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-14"><img data-src="Bayes_files/img/diagnosis.svg" class="no-lightbox" style="width:85.0%"></a></p>
</div><div class="column" style="width:80%;">
<ul>
<li><p>Compare la variance <span style="color:#ED4F33">inter</span>-chaînes <span style="color:#ED4F33"><span class="math inline">\(B\)</span></span> à la variance <span style="color:#ED4F33">intra</span>-chaînes (<span style="color:#ED4F33"><span class="math inline">\(W\)</span></span>)</p></li>
<li><p>Si distribution stationnaire, la différence moyenne entre les chaînes devrait correspondre à la différence moyenne intra-chaîne</p></li>
<li><p><em>Potential Scale Reduction Factor</em> (PSRF) / <em>Shrink Factor</em> : implique le ratio entre la variance poolée et la variance intra-chaînes</p></li>
<li><p><span class="math inline">\(\textrm{PSRF} &gt; 1.2\)</span> ou <span class="math inline">\(1.1\)</span> est signe de <span style="color:#ED4F33">non-convergence</span></p></li>
</ul>
</div>
</div>
</section>
<section id="diagnostic-de-gelman-rubin---500-itérations" class="slide level2">
<h2>Diagnostic de Gelman &amp; Rubin - 500 itérations</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a></a><span class="fu">library</span>(coda)</span>
<span id="cb16-2"><a></a><span class="co"># Mise au format coda</span></span>
<span id="cb16-3"><a></a>simul <span class="ot">&lt;-</span> <span class="fu">mcmc.list</span>(<span class="fu">as.mcmc</span>(chaine1),<span class="fu">as.mcmc</span>(chaine2),<span class="fu">as.mcmc</span>(chaine3))</span>
<span id="cb16-4"><a></a></span>
<span id="cb16-5"><a></a><span class="co"># 500 itérations</span></span>
<span id="cb16-6"><a></a><span class="fu">gelman.diag</span>(simul)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Potential scale reduction factors:

     Point est. Upper C.I.
[1,]       1.53       3.09</code></pre>
</div>
</div>
<p>Convergence non atteinte.</p>
</section>
<section id="diagnostic-de-gelman-rubin---5000-itérations" class="slide level2">
<h2>Diagnostic de Gelman &amp; Rubin - 5000 itérations</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a></a>chaine1 <span class="ot">&lt;-</span> <span class="fu">mh</span>(<span class="at">nIter =</span> <span class="dv">5000</span>, <span class="at">thetaInit =</span> <span class="fl">0.01</span>, <span class="at">candSD =</span> <span class="fl">0.015</span>)<span class="sc">$</span>theta</span>
<span id="cb18-2"><a></a>chaine2 <span class="ot">&lt;-</span> <span class="fu">mh</span>(<span class="at">nIter =</span> <span class="dv">5000</span>, <span class="at">thetaInit =</span> <span class="fl">0.99</span>, <span class="at">candSD =</span> <span class="fl">0.015</span>)<span class="sc">$</span>theta</span>
<span id="cb18-3"><a></a>chaine3 <span class="ot">&lt;-</span> <span class="fu">mh</span>(<span class="at">nIter =</span> <span class="dv">5000</span>, <span class="at">thetaInit =</span> <span class="fl">0.50</span>, <span class="at">candSD =</span> <span class="fl">0.015</span>)<span class="sc">$</span>theta</span>
<span id="cb18-4"><a></a></span>
<span id="cb18-5"><a></a><span class="co"># Mise au format coda</span></span>
<span id="cb18-6"><a></a>simul <span class="ot">&lt;-</span> <span class="fu">mcmc.list</span>(<span class="fu">as.mcmc</span>(chaine1),<span class="fu">as.mcmc</span>(chaine2),<span class="fu">as.mcmc</span>(chaine3))</span>
<span id="cb18-7"><a></a></span>
<span id="cb18-8"><a></a><span class="co"># 5000 itérations</span></span>
<span id="cb18-9"><a></a><span class="fu">gelman.diag</span>(simul)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Potential scale reduction factors:

     Point est. Upper C.I.
[1,]       1.18       1.51</code></pre>
</div>
</div>
</section>
<section id="précision-autocorrélation" class="slide level2">
<h2>Précision : Autocorrélation</h2>
<div class="columns">
<div class="column" style="width:20%;">
<p><a href="Bayes_files/img/twins.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-15"><img data-src="Bayes_files/img/twins.svg" class="no-lightbox" style="width:85.0%"></a></p>
</div><div class="column" style="width:80%;">
<ul>
<li><p>Mesure le degré de dépendance entre <span class="math inline">\(\theta_t\)</span> et les valeurs passées (<em>lags</em>) <span class="math inline">\(\theta_{k}\)</span></p></li>
<li><p>Mesure de la quantité d’information disponible dans la chaîne</p></li>
<li><p><em><span style="color:#ED4F33">Effective Sample Size</span></em> : nombre de réalisations indépendantes de l’a posteriori nécessaires pour avoir une information équivalente à celle de la chaîne</p></li>
</ul>
</div>
</div>
</section>
<section id="autocorrélation" class="slide level2">
<h2>Autocorrélation</h2>
<div class="columns">
<div class="column" style="width:60%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a></a><span class="fu">autocorr.plot</span>(<span class="fu">as.mcmc</span>(chaine3),<span class="at">lag.max=</span><span class="dv">200</span>,<span class="at">lwd=</span><span class="dv">2</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><a href="Bayes_files/figure-revealjs/AutocorrPlot-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-16"><img data-src="Bayes_files/figure-revealjs/AutocorrPlot-1.png" style="width:95.0%"></a></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a></a><span class="fu">autocorr.diag</span>(<span class="fu">as.mcmc</span>(chaine3))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            [,1]
Lag 0  1.0000000
Lag 1  0.9895226
Lag 5  0.9473690
Lag 10 0.8911419
Lag 50 0.5387291</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="ess-raftery-lewis" class="slide level2 smaller">
<h2>ESS, Raftery &amp; Lewis</h2>
<div class="columns">
<div class="column" style="width:40%;">
<p><strong>ESS</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a></a><span class="fu">effectiveSize</span>(<span class="fu">as.mcmc</span>(chaine3))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    var1 
26.32621 </code></pre>
</div>
</div>
<p>Les 5 000 itérations correspondent à 26 réalisations indépendantes de l’a posteriori.</p>
</div><div class="column" style="width:60%;">
<div class="fragment">
<p>Un IC <em>equal-tailed</em> va demander une connaissance précise des queues de distribution.</p>
<p>Raftery &amp; Lewis estime le nombre d’itérations nécessaires pour l’estimation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a></a><span class="fu">raftery.diag</span>(<span class="fu">as.mcmc</span>(chaine3))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Quantile (q) = 0.025
Accuracy (r) = +/- 0.005
Probability (s) = 0.95 
                                       
 Burn-in  Total Lower bound  Dependence
 (M)      (N)   (Nmin)       factor (I)
 75       74586 3746         19.9      </code></pre>
</div>
</div>
<p>Il faut 3 746 réalisations indépendantes de l’a posteriori pour estimer un <span class="math inline">\(IC_{95\%}\)</span> avec une précision de <span class="math inline">\(\pm 0.005\)</span> sur les bornes, soit 74 586 itérations en tenant compte de l’autocorrélation.</p>
</div>
</div>
</div>
</section>
<section id="logiciels-dinférence-bayésienne-dans" class="slide level2">
<h2>Logiciels d’inférence Bayésienne dans <img data-src="Bayes_files/img/Rlogo.svg" class="no-lightbox" style="width:7.0%"></h2>
<ul>
<li><p>BUGS : <strong>B</strong>ayesian inference <strong>U</strong>sing <strong>G</strong>ibbs <strong>S</strong>ampling</p>
<ul>
<li>WinBUGS (<code>R2WinBUGS</code>), OpenBUGS (<code>BRugs</code>, <code>R2OpenBUGS</code>), MultiBUGS</li>
</ul></li>
<li><p>Extensions de BUGS :</p>
<ul>
<li><p><span class="fragment highlight-blue">JAGS</span> : <strong>J</strong>ust <strong>A</strong>nother <strong>G</strong>ibbs <strong>S</strong>ampler (<code>rjags</code> / <code>R2jags</code>, <code>runjags</code>)</p></li>
<li><p>NIMBLE : intégré à R, plusieurs algorithmes d’estimation possibles</p></li>
</ul></li>
<li><p><span class="fragment highlight-blue">Stan</span> (nommé en référence à Stanislaw Ulam) (<code>rstan</code>, <code>rstanarm</code>, <code>brms</code>), basé essentiellement sur du Hamiltonian Monte Carlo (HMC)</p></li>
<li><p>INLA : <strong>I</strong>ntegrated <strong>N</strong>ested <strong>L</strong>aplace <strong>A</strong>pproximation, alternative plus rapide au MCMC pour une large famille de modèles</p></li>
</ul>
</section></section>
<section>
<section id="estimation-bayésienne-probabilité-theta-de-guérison" class="title-slide slide level1 center">
<h1>Estimation bayésienne : probabilité <span class="math inline">\(\theta\)</span> de guérison</h1>

</section>
<section id="estimation-conjuguée-de-theta" class="slide level2">
<h2>Estimation conjuguée de <span class="math inline">\(\theta\)</span></h2>
<div class="columns">
<div class="column" style="width:20%;">
<p><a href="Bayes_files/img/Diagram8_2.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-17"><img data-src="Bayes_files/img/Diagram8_2.svg" style="width:80.0%"></a></p>
</div><div class="column" style="width:80%;">
<ul>
<li><p><span class="math inline">\(n=10\)</span> patients, <span class="math inline">\(k=7\)</span> guéris</p></li>
<li><p>Pour chaque patient <span class="math inline">\(i\)</span>, la guérison suit une loi de Bernoulli : <span class="math inline">\(\color{#ED4F33}{P(y_i=1|\theta)} = \theta^{y_i} (1-\theta)^{1-y_i}\)</span></p></li>
<li><p>A priori <span class="math inline">\(\color{#F5B12E}{P(\theta)} \sim \textrm{beta}(a,b)\)</span></p></li>
</ul>
</div>
</div>
</section>
<section id="probabilité-theta-de-guérison-données" class="slide level2">
<h2>Probabilité <span class="math inline">\(\theta\)</span> de guérison : données</h2>
<p>Les données sont fournies sous forme de liste.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a></a>y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>) <span class="co"># 1=Succès</span></span>
<span id="cb27-2"><a></a>n <span class="ot">&lt;-</span> <span class="fu">length</span>(y)</span>
<span id="cb27-3"><a></a></span>
<span id="cb27-4"><a></a>donnees <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">y =</span> y,</span>
<span id="cb27-5"><a></a>                <span class="at">nbsuj =</span> n)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="probabilité-theta-de-guérison-modèle" class="slide level2">
<h2>Probabilité <span class="math inline">\(\theta\)</span> de guérison : modèle</h2>
<div class="panel-tabset">
<ul id="tabset-1" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-1-1">JAGS Bernouilli</a></li><li><a href="#tabset-1-2">JAGS binomial</a></li><li><a href="#tabset-1-3">Stan</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1">
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-40"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-40-1"><a href="#annotated-cell-40-1"></a>modeleJAGS1 <span class="ot">&lt;-</span> </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-40" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-40-2" class="code-annotation-target"><a href="#annotated-cell-40-2"></a><span class="st">"</span></span>
<span id="annotated-cell-40-3"><a href="#annotated-cell-40-3"></a><span class="st"> model {</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-40" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-40-4" class="code-annotation-target"><a href="#annotated-cell-40-4"></a><span class="st">  for (i in 1:nbsuj) {</span></span>
<span id="annotated-cell-40-5"><a href="#annotated-cell-40-5"></a><span class="st">   y[i] ~ dbern(theta)</span></span>
<span id="annotated-cell-40-6"><a href="#annotated-cell-40-6"></a><span class="st">  }</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-40" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-40-7" class="code-annotation-target"><a href="#annotated-cell-40-7"></a><span class="st">  theta ~ dbeta(1, 1)</span></span>
<span id="annotated-cell-40-8"><a href="#annotated-cell-40-8"></a><span class="st"> }</span></span>
<span id="annotated-cell-40-9"><a href="#annotated-cell-40-9"></a><span class="st">"</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-40" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-40" data-code-lines="2,9" data-code-annotation="1">Définir le modèle comme chaîne de caractères</span>
</dd>
<dt data-target-cell="annotated-cell-40" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-40" data-code-lines="4,5,6" data-code-annotation="2">Définir la vraisemblance (Bernouilli) pour les <span class="math inline">\(y_i\)</span></span>
</dd>
<dt data-target-cell="annotated-cell-40" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-40" data-code-lines="7" data-code-annotation="3">Définir l’a priori pour <span class="math inline">\(\theta\)</span></span>
</dd>
</dl>
</div>
</div>
</div>
<div id="tabset-1-2">
<p>De façon équivalente à partir de la distribution binomiale :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28" data-code-line-numbers="3-5|8|9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a></a>modeleJAGS2 <span class="ot">&lt;-</span> </span>
<span id="cb28-2"><a></a><span class="st">"             </span></span>
<span id="cb28-3"><a></a><span class="st"> data {</span></span>
<span id="cb28-4"><a></a><span class="st">  nbgueri &lt;- sum(y)             # Nombre de guérisons</span></span>
<span id="cb28-5"><a></a><span class="st"> }</span></span>
<span id="cb28-6"><a></a><span class="st"> </span></span>
<span id="cb28-7"><a></a><span class="st"> model {</span></span>
<span id="cb28-8"><a></a><span class="st">  nbgueri ~ dbinom(theta,nbsuj) # Vraisemblance (binomiale)</span></span>
<span id="cb28-9"><a></a><span class="st">  theta ~ dbeta(1, 1)           # a priori</span></span>
<span id="cb28-10"><a></a><span class="st"> } </span></span>
<span id="cb28-11"><a></a><span class="st">"</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-3">
<div class="columns">
<div class="column" style="width:35%;">
<p>Plusieurs blocs :</p>
<ul>
<li><p>Données (obligatoire)</p></li>
<li><p>Données transformées</p></li>
<li><p>Paramètres (obligatoire)</p></li>
<li><p>Paramètres transformés</p></li>
<li><p>Modèle (obligatoire)</p></li>
<li><p>Quantités générées</p></li>
</ul>
</div><div class="column" style="width:65%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb29" data-code-line-numbers="3-6|8-10|13|14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a></a>modeleStan <span class="ot">&lt;-</span></span>
<span id="cb29-2"><a></a><span class="st">"</span></span>
<span id="cb29-3"><a></a><span class="st">data {</span></span>
<span id="cb29-4"><a></a><span class="st">  int&lt;lower=0&gt; nbsuj;             // nombre de patients</span></span>
<span id="cb29-5"><a></a><span class="st">  int&lt;lower=0, upper=1&gt; y[nbsuj]; // résultats</span></span>
<span id="cb29-6"><a></a><span class="st">}</span></span>
<span id="cb29-7"><a></a></span>
<span id="cb29-8"><a></a><span class="st">parameters {</span></span>
<span id="cb29-9"><a></a><span class="st">  real&lt;lower=0, upper=1&gt; theta;   // chances de guérison</span></span>
<span id="cb29-10"><a></a><span class="st">}</span></span>
<span id="cb29-11"><a></a></span>
<span id="cb29-12"><a></a><span class="st">model {</span></span>
<span id="cb29-13"><a></a><span class="st">  theta ~ beta(1, 1);             // a priori</span></span>
<span id="cb29-14"><a></a><span class="st">  y ~ bernoulli(theta);           // vraisemblance</span></span>
<span id="cb29-15"><a></a><span class="st">}</span></span>
<span id="cb29-16"><a></a><span class="st">"</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="probabilité-theta-de-guérison-valeurs-initiales" class="slide level2">
<h2>Probabilité <span class="math inline">\(\theta\)</span> de guérison : valeurs initiales</h2>
<p>Recommandé avec JAGS pour :</p>
<ul>
<li><p>vérifier la convergence en partant de valeurs différentes de <span class="math inline">\(\theta_0\)</span> ou</p></li>
<li><p>les modèles complexes (meilleures performances en partant d’une valeur à haute probabilité a posteriori)</p></li>
</ul>
<div class="fragment">
<p>Les valeurs initiales sont fournies sous forme de liste :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a></a>inits <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb30-2"><a></a>  resampleY <span class="ot">&lt;-</span> <span class="fu">sample</span>(y , <span class="at">replace=</span><span class="cn">TRUE</span>)      <span class="co"># Rééchantillonage des y</span></span>
<span id="cb30-3"><a></a>  theta0 <span class="ot">&lt;-</span> <span class="fu">sum</span>(resampleY)<span class="sc">/</span><span class="fu">length</span>(resampleY) <span class="co"># EMV</span></span>
<span id="cb30-4"><a></a>  theta0 <span class="ot">&lt;-</span> <span class="fl">0.001</span> <span class="sc">+</span> <span class="fl">0.998</span><span class="sc">*</span>theta0             <span class="co"># Eviter des valeurs de 0 ou 1</span></span>
<span id="cb30-5"><a></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">theta=</span>theta0))</span>
<span id="cb30-6"><a></a>}</span>
<span id="cb30-7"><a></a><span class="fu">unlist</span>(<span class="fu">replicate</span>(<span class="dv">5</span>, <span class="fu">inits</span>()))                <span class="co"># Exemple : 5 tirages de inits()</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> theta  theta  theta  theta  theta 
0.5000 0.5998 0.6996 0.5000 0.8992 </code></pre>
</div>
</div>
</div>
</section>
<section id="probabilité-theta-de-guérison-initialisation-du-modèle" class="slide level2">
<h2>Probabilité <span class="math inline">\(\theta\)</span> de guérison : initialisation du modèle</h2>
<div class="panel-tabset">
<ul id="tabset-2" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-2-1">JAGS</a></li><li><a href="#tabset-2-2">Stan</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1">
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a></a><span class="fu">library</span>(<span class="st">"rjags"</span>) </span>
<span id="cb32-2"><a></a><span class="do">## Initialisation du modèle</span></span>
<span id="cb32-3"><a></a>modJ1 <span class="ot">&lt;-</span> <span class="fu">jags.model</span>(<span class="at">file=</span><span class="fu">textConnection</span>(modeleJAGS1), <span class="co"># Modèle</span></span>
<span id="cb32-4"><a></a>                    <span class="at">data=</span>donnees,                     <span class="co"># Données</span></span>
<span id="cb32-5"><a></a>                    <span class="at">inits=</span>inits,                      <span class="co"># valeurs initiales (optionnel)</span></span>
<span id="cb32-6"><a></a>                    <span class="at">n.chains=</span><span class="dv">3</span>)                       <span class="co"># Nombre de chaînes</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Compiling model graph
   Resolving undeclared variables
   Allocating nodes
Graph information:
   Observed stochastic nodes: 10
   Unobserved stochastic nodes: 1
   Total graph size: 13

Initializing model</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a></a><span class="do">## Burn-in</span></span>
<span id="cb34-2"><a></a><span class="fu">update</span>(modJ1, <span class="at">n.iter =</span> <span class="dv">500</span>)                           <span class="co"># 500 itérations de burn-in</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-2-2">
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a></a><span class="fu">library</span>(<span class="st">"rstan"</span>) </span>
<span id="cb35-2"><a></a><span class="do">## Compile le modèle en C++ puis crée un dynamic shared object (DSO)</span></span>
<span id="cb35-3"><a></a>modS <span class="ot">&lt;-</span> <span class="fu">stan_model</span>(<span class="at">model_code =</span> modeleStan, <span class="at">model_name =</span> <span class="st">"modeleStan"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Avec Stan, il est possible de définir le <em>burn-in</em> (nommé <em>warmup</em>) directement à l’étape suivante.</p>
</div>
</div>
</div>
</section>
<section id="probabilité-theta-de-guérison-simulations" class="slide level2">
<h2>Probabilité <span class="math inline">\(\theta\)</span> de guérison : simulations</h2>
<div class="panel-tabset">
<ul id="tabset-3" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-3-1">JAGS</a></li><li><a href="#tabset-3-2">Stan</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1">
<p>Une fois le <em>burn-in</em> effectué, on échantillonne l’a posteriori à partir de la fonction <code>coda.samples</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a></a>modJ1_sim <span class="ot">&lt;-</span> <span class="fu">coda.samples</span>(<span class="at">model=</span>modJ1,               <span class="co"># modèle compilé</span></span>
<span id="cb36-2"><a></a>                          <span class="at">variable.names=</span><span class="fu">c</span>(<span class="st">"theta"</span>), <span class="co"># variables à conserver, sous forme de vecteur</span></span>
<span id="cb36-3"><a></a>                          <span class="at">n.iter=</span><span class="dv">3500</span>)               <span class="co"># nombre d'itérations par chaîne</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-3-2">
<p>On échantillonne l’a posteriori à partir de la fonction <code>sampling</code>, en définissant le <em>burn-in</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a></a>modS_sim <span class="ot">&lt;-</span> <span class="fu">sampling</span>(<span class="at">object=</span>modS,  <span class="co"># DSO compilé</span></span>
<span id="cb37-2"><a></a>                     <span class="at">data=</span>donnees, <span class="co"># données</span></span>
<span id="cb37-3"><a></a>                     <span class="at">chains=</span><span class="dv">3</span>,     <span class="co"># nombre de chaînes (4 par défaut)</span></span>
<span id="cb37-4"><a></a>                     <span class="at">iter=</span><span class="dv">4000</span>,    <span class="co"># nombre total de réalisations (inclant le burn-in)</span></span>
<span id="cb37-5"><a></a>                     <span class="at">warmup=</span><span class="dv">500</span>)   <span class="co"># nombre d'itérations pour le burn-in (iter/2 par défaut)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="diagnostic-trace-plot" class="slide level2">
<h2>Diagnostic : trace plot</h2>
<div class="panel-tabset">
<ul id="tabset-4" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-4-1">JAGS</a></li><li><a href="#tabset-4-2">Stan</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1">
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a></a><span class="fu">library</span>(ggmcmc)</span>
<span id="cb38-2"><a></a>SJ1 <span class="ot">&lt;-</span> <span class="fu">ggs</span>(modJ1_sim) </span>
<span id="cb38-3"><a></a><span class="fu">ggs_traceplot</span>(SJ1, <span class="at">greek =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="fu">theme_grey</span>(<span class="at">base_size=</span><span class="dv">25</span>) </span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><a href="Bayes_files/figure-revealjs/ProbGueTracePlotJ1-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-18"><img data-src="Bayes_files/figure-revealjs/ProbGueTracePlotJ1-1.png" style="width:95.0%"></a></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-4-2">
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a></a><span class="fu">library</span>(ggmcmc)</span>
<span id="cb39-2"><a></a>SS <span class="ot">&lt;-</span> <span class="fu">ggs</span>(modS_sim) </span>
<span id="cb39-3"><a></a><span class="fu">ggs_traceplot</span>(SS, <span class="at">greek =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="fu">theme_grey</span>(<span class="at">base_size=</span><span class="dv">25</span>) </span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><a href="Bayes_files/figure-revealjs/ProbGueTracePlotS-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-19"><img data-src="Bayes_files/figure-revealjs/ProbGueTracePlotS-1.png" style="width:95.0%"></a></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="diagnostic-densité" class="slide level2">
<h2>Diagnostic : densité</h2>
<div class="panel-tabset">
<ul id="tabset-5" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-5-1">JAGS</a></li><li><a href="#tabset-5-2">Stan</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1">
<div class="cell columns column-output-location">
<div class="column">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a></a><span class="fu">ggs_density</span>(SJ1, </span>
<span id="cb40-2"><a></a>            <span class="at">greek =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb40-3"><a></a>  <span class="fu">xlim</span>(<span class="dv">0</span>,<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb40-4"><a></a>  <span class="fu">theme_grey</span>(<span class="at">base_size=</span><span class="dv">25</span>) </span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column">
<div class="cell-output-display">
<div>
<figure>
<p><a href="Bayes_files/figure-revealjs/ProbGueDensityJ1-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-20"><img data-src="Bayes_files/figure-revealjs/ProbGueDensityJ1-1.png" style="width:95.0%"></a></p>
</figure>
</div>
</div>
</div>
</div>
</div>
<div id="tabset-5-2">
<div class="cell columns column-output-location">
<div class="column">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a></a><span class="fu">ggs_density</span>(SS, </span>
<span id="cb41-2"><a></a>            <span class="at">greek =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb41-3"><a></a>  <span class="fu">xlim</span>(<span class="dv">0</span>,<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb41-4"><a></a>  <span class="fu">theme_grey</span>(<span class="at">base_size=</span><span class="dv">25</span>) </span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column">
<div class="cell-output-display">
<div>
<figure>
<p><a href="Bayes_files/figure-revealjs/ProbGueDensityS-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-21"><img data-src="Bayes_files/figure-revealjs/ProbGueDensityS-1.png" style="width:95.0%"></a></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="diagnostic-convergence-hatr" class="slide level2">
<h2>Diagnostic : convergence (<span class="math inline">\(\hat{R}\)</span>)</h2>
<div class="panel-tabset">
<ul id="tabset-6" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-6-1">JAGS</a></li><li><a href="#tabset-6-2">Stan</a></li></ul>
<div class="tab-content">
<div id="tabset-6-1">
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a></a><span class="fu">ggs_diagnostics</span>(SJ1, <span class="at">version_rhat =</span> <span class="st">"BG98"</span>) <span class="sc">%&gt;%</span> <span class="co"># Version de Brooks &amp; Gelman utilisée dans coda</span></span>
<span id="cb42-2"><a></a>  <span class="fu">filter</span>(Diagnostic<span class="sc">==</span><span class="st">"Rhat"</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(Parameter, value)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  Parameter value
  &lt;fct&gt;     &lt;dbl&gt;
1 theta      1.00</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a></a><span class="fu">gelman.diag</span>(modJ1_sim)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Potential scale reduction factors:

      Point est. Upper C.I.
theta          1          1</code></pre>
</div>
</div>
</div>
<div id="tabset-6-2">
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a></a><span class="fu">ggs_diagnostics</span>(SS, <span class="at">version_rhat =</span> <span class="st">"BG98"</span>) <span class="sc">%&gt;%</span> <span class="co"># Version de Brooks &amp; Gelman utilisée dans coda</span></span>
<span id="cb46-2"><a></a>  <span class="fu">filter</span>(Diagnostic<span class="sc">==</span><span class="st">"Rhat"</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(Parameter, value)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  Parameter value
  &lt;fct&gt;     &lt;dbl&gt;
1 theta      1.00</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="diagnostic-autocorrélation-et-ess" class="slide level2">
<h2>Diagnostic : autocorrélation et ESS</h2>
<div class="panel-tabset">
<ul id="tabset-7" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-7-1">JAGS</a></li><li><a href="#tabset-7-2">Stan</a></li></ul>
<div class="tab-content">
<div id="tabset-7-1">
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a></a><span class="fu">ggs_autocorrelation</span>(SJ1, <span class="at">greek =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="sc">-</span>.<span class="dv">2</span>,<span class="dv">1</span>) <span class="sc">+</span> <span class="fu">theme_grey</span>(<span class="at">base_size=</span><span class="dv">25</span>) </span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><a href="Bayes_files/figure-revealjs/ProbGueAutocorrJ1-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-22"><img data-src="Bayes_files/figure-revealjs/ProbGueAutocorrJ1-1.png" style="width:95.0%"></a></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a></a><span class="fu">ggs_diagnostics</span>(SJ1, <span class="at">proportion=</span><span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Diagnostic<span class="sc">==</span><span class="st">"Effective"</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(Parameter, value)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  Parameter  value
  &lt;fct&gt;      &lt;dbl&gt;
1 theta     10820.</code></pre>
</div>
</div>
</div>
<div id="tabset-7-2">
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a></a><span class="fu">ggs_autocorrelation</span>(SS, <span class="at">greek =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="sc">-</span>.<span class="dv">2</span>,<span class="dv">1</span>) <span class="sc">+</span> <span class="fu">theme_grey</span>(<span class="at">base_size=</span><span class="dv">25</span>) </span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><a href="Bayes_files/figure-revealjs/ProbGueAutocorrS-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-23"><img data-src="Bayes_files/figure-revealjs/ProbGueAutocorrS-1.png" style="width:95.0%"></a></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a></a><span class="fu">ggs_diagnostics</span>(SS, <span class="at">proportion=</span><span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Diagnostic<span class="sc">==</span><span class="st">"Effective"</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(Parameter, value)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  Parameter value
  &lt;fct&gt;     &lt;dbl&gt;
1 theta     4186.</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="diagnostic-précision-pour-lhdi" class="slide level2">
<h2>Diagnostic : précision pour l’HDI</h2>
<div class="panel-tabset">
<ul id="tabset-8" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-8-1">JAGS</a></li><li><a href="#tabset-8-2">Stan</a></li></ul>
<div class="tab-content">
<div id="tabset-8-1">
<p>Il faut fusionner les réalisations des 3 chaînes pour ne pas obtenir un diagnostic par chaîne.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a></a><span class="fu">raftery.diag</span>(<span class="fu">as.mcmc</span>(<span class="fu">do.call</span>(rbind, modJ1_sim)))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Quantile (q) = 0.025
Accuracy (r) = +/- 0.005
Probability (s) = 0.95 
                                             
       Burn-in  Total Lower bound  Dependence
       (M)      (N)   (Nmin)       factor (I)
 theta 2        3826  3746         1.02      </code></pre>
</div>
</div>
</div>
<div id="tabset-8-2">
<p>Il faut convertir au format coda (<code>As.mcmc.list</code>) puis fusionner les réalisations des 3 chaînes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a></a><span class="fu">raftery.diag</span>(<span class="fu">as.mcmc</span>(<span class="fu">do.call</span>(rbind, <span class="fu">As.mcmc.list</span>(modS_sim))))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Quantile (q) = 0.025
Accuracy (r) = +/- 0.005
Probability (s) = 0.95 
                                             
       Burn-in  Total Lower bound  Dependence
       (M)      (N)   (Nmin)       factor (I)
 theta 8        9560  3746         2.55      
 lp__  6        7127  3746         1.90      </code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="probabilité-theta-de-guérison-estimations" class="slide level2">
<h2>Probabilité <span class="math inline">\(\theta\)</span> de guérison : estimations</h2>
<div class="panel-tabset">
<ul id="tabset-9" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-9-1">JAGS</a></li><li><a href="#tabset-9-2">Stan</a></li></ul>
<div class="tab-content">
<div id="tabset-9-1">
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a></a><span class="fu">summary</span>(modJ1_sim)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Iterations = 501:4000
Thinning interval = 1 
Number of chains = 3 
Sample size per chain = 3500 

1. Empirical mean and standard deviation for each variable,
   plus standard error of the mean:

          Mean             SD       Naive SE Time-series SE 
      0.663950       0.130396       0.001273       0.001260 

2. Quantiles for each variable:

  2.5%    25%    50%    75%  97.5% 
0.3936 0.5779 0.6716 0.7608 0.8889 </code></pre>
</div>
</div>
</div>
<div id="tabset-9-2">
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a></a>modS_sim</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Inference for Stan model: modeleStan.
3 chains, each with iter=4000; warmup=500; thin=1; 
post-warmup draws per chain=3500, total post-warmup draws=10500.

       mean se_mean   sd   2.5%   25%   50%   75% 97.5% n_eff Rhat
theta  0.66    0.00 0.13   0.39  0.57  0.67  0.76  0.89  4358    1
lp__  -8.15    0.01 0.73 -10.27 -8.32 -7.87 -7.69 -7.64  3791    1

Samples were drawn using NUTS(diag_e) at Tue Feb 27 00:41:06 2024.
For each parameter, n_eff is a crude measure of effective sample size,
and Rhat is the potential scale reduction factor on split chains (at 
convergence, Rhat=1).</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="probabilité-theta-de-guérison-hdi" class="slide level2">
<h2>Probabilité <span class="math inline">\(\theta\)</span> de guérison : HDI</h2>
<div class="panel-tabset">
<ul id="tabset-10" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-10-1">JAGS</a></li><li><a href="#tabset-10-2">Stan</a></li></ul>
<div class="tab-content">
<div id="tabset-10-1">
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a></a><span class="fu">HPDinterval</span>(<span class="fu">as.mcmc</span>(<span class="fu">do.call</span>(rbind, modJ1_sim)))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          lower     upper
theta 0.4090384 0.8995242
attr(,"Probability")
[1] 0.95</code></pre>
</div>
</div>
</div>
<div id="tabset-10-2">
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a></a><span class="fu">HPDinterval</span>(<span class="fu">as.mcmc</span>(<span class="fu">do.call</span>(rbind, <span class="fu">As.mcmc.list</span>(modS_sim))))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           lower      upper
theta  0.4141155  0.9065491
lp__  -9.5984857 -7.6381700
attr(,"Probability")
[1] 0.95</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="probabilité-theta-de-guérison-histogramme" class="slide level2">
<h2>Probabilité <span class="math inline">\(\theta\)</span> de guérison : Histogramme</h2>
<div class="panel-tabset">
<ul id="tabset-11" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-11-1">JAGS</a></li><li><a href="#tabset-11-2">Stan</a></li></ul>
<div class="tab-content">
<div id="tabset-11-1">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><a href="Bayes_files/figure-revealjs/ProbGueHistJ1-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-24"><img data-src="Bayes_files/figure-revealjs/ProbGueHistJ1-1.png" style="width:95.0%"></a></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-11-2">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><a href="Bayes_files/figure-revealjs/ProbGueHistS-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-25"><img data-src="Bayes_files/figure-revealjs/ProbGueHistS-1.png" style="width:95.0%"></a></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section></section>
<section>
<section id="comparaison-de-2-traitements-régression-logistique" class="title-slide slide level1 center">
<h1>Comparaison de 2 traitements : régression logistique</h1>

</section>
<section id="données" class="slide level2">
<h2>Données</h2>
<div class="cell">
<div class="cell-output-display">
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Traitement</th>
<th style="text-align: right;">Succès</th>
<th style="text-align: right;">Échecs</th>
<th style="text-align: right;">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Placebo</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">96</td>
<td style="text-align: right;">143</td>
</tr>
<tr class="even">
<td style="text-align: left;">Crème</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">75</td>
<td style="text-align: right;">130</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Total</td>
<td style="text-align: right;">102</td>
<td style="text-align: right;">171</td>
<td style="text-align: right;">273</td>
</tr>
</tbody>
</table>
</div>
</div>

<aside><div>
<p>source: Agresti 2002, Categorical Data Analysis</p>
</div></aside></section>
<section id="modèle-concept" class="slide level2">
<h2>Modèle : concept</h2>
<div class="columns">
<div class="column" style="width:20%;">
<p><a href="Bayes_files/img/Diagram21_2.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-26"><img data-src="Bayes_files/img/Diagram21_2.svg" style="width:95.0%"></a></p>
</div><div class="column" style="width:25%;">
<table>
<thead>
<tr class="header">
<th style="text-align: left;">y</th>
<th style="text-align: left;">t</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;">1 (crème)</td>
</tr>
<tr class="even">
<td style="text-align: left;">0</td>
<td style="text-align: left;">1 (crème)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;">0 (placebo)</td>
</tr>
<tr class="even">
<td style="text-align: left;">0</td>
<td style="text-align: left;">0 (placebo)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0</td>
<td style="text-align: left;">0 (placebo)</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: left;">1 (crème)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">…</td>
<td style="text-align: left;">…</td>
</tr>
</tbody>
</table>
</div><div class="column" style="width:55%;">
<ul>
<li><p>Modèle GLM basé sur le lien <span class="math inline">\(\textrm{logit}(P) = \log\left(\frac{P}{1-P}\right)\)</span></p></li>
<li><p><span class="math inline">\(\color{#ED4F33}{P(y_{i|t}=1|\beta_0, \beta_1)} = \frac{1}{1+\exp(-\mu_i)}\)</span></p></li>
<li><p><span class="math inline">\(\mu_i = \beta_0 + \beta_1 t_i\)</span></p></li>
<li><p>a prioris <span class="math inline">\(\color{#F5B12E}{P(\beta_j)} \sim \textrm{norm}(\mu,\sigma)\)</span></p></li>
<li><p>JAGS paramétrise la loi normale à partir de la <strong>précision</strong> (inverse de la variance)</p></li>
<li><p>JAGS : fonctions <code>logit</code> et <code>ilogit</code> (loi logistique)</p></li>
</ul>
</div>
</div>
</section>
<section id="modèle" class="slide level2">
<h2>Modèle</h2>
<div class="panel-tabset">
<ul id="tabset-12" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-12-1">JAGS</a></li><li><a href="#tabset-12-2">Stan</a></li></ul>
<div class="tab-content">
<div id="tabset-12-1">
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a></a>modeleJAGSL <span class="ot">&lt;-</span> </span>
<span id="cb66-2"><a></a> <span class="st">" </span></span>
<span id="cb66-3"><a></a><span class="st">  model {</span></span>
<span id="cb66-4"><a></a><span class="st">    for (i in 1:nbsuj) {</span></span>
<span id="cb66-5"><a></a><span class="st">      y[i] ~ dbern(mu[i]) </span></span>
<span id="cb66-6"><a></a><span class="st">      mu[i] = ilogit(beta0 + beta1*t[i])</span></span>
<span id="cb66-7"><a></a><span class="st">      # ou : logit(mu[i]) = beta0 + beta1*t[i]</span></span>
<span id="cb66-8"><a></a><span class="st">    }</span></span>
<span id="cb66-9"><a></a><span class="st">    </span></span>
<span id="cb66-10"><a></a><span class="st">    # A prioris</span></span>
<span id="cb66-11"><a></a><span class="st">      beta0 ~ dnorm(0, 1/100^2) </span></span>
<span id="cb66-12"><a></a><span class="st">      beta1 ~ dnorm(0, 1/100^2) </span></span>
<span id="cb66-13"><a></a><span class="st">  }</span></span>
<span id="cb66-14"><a></a><span class="st">"</span> </span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-12-2">
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a></a>modeleStanL <span class="ot">&lt;-</span></span>
<span id="cb67-2"><a></a><span class="st">"</span></span>
<span id="cb67-3"><a></a><span class="st">data {</span></span>
<span id="cb67-4"><a></a><span class="st">  int&lt;lower=0&gt; nbsuj;              // nombre de patients</span></span>
<span id="cb67-5"><a></a><span class="st">  int&lt;lower=0, upper=1&gt; y[nbsuj];  // résultats</span></span>
<span id="cb67-6"><a></a><span class="st">  vector[nbsuj] t;                 // traitement</span></span>
<span id="cb67-7"><a></a><span class="st">}</span></span>
<span id="cb67-8"><a></a><span class="st">parameters {</span></span>
<span id="cb67-9"><a></a><span class="st">  real beta0;                      // intercept</span></span>
<span id="cb67-10"><a></a><span class="st">  real beta1;                      // log-OR</span></span>
<span id="cb67-11"><a></a><span class="st">}</span></span>
<span id="cb67-12"><a></a><span class="st">model {</span></span>
<span id="cb67-13"><a></a><span class="st">  beta0 ~ normal(0, 100);                 // a priori</span></span>
<span id="cb67-14"><a></a><span class="st">  beta1 ~ normal(0, 100);                 // a priori</span></span>
<span id="cb67-15"><a></a><span class="st">  y ~ bernoulli_logit(beta0 + beta1 * t); // vraisemblance</span></span>
<span id="cb67-16"><a></a><span class="st">}</span></span>
<span id="cb67-17"><a></a><span class="st">"</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="résultats" class="slide level2">
<h2>Résultats</h2>
<div class="panel-tabset">
<ul id="tabset-13" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-13-1">JAGS</a></li><li><a href="#tabset-13-2">Stan</a></li></ul>
<div class="tab-content">
<div id="tabset-13-1">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Iterations = 2501:12500
Thinning interval = 1 
Number of chains = 3 
Sample size per chain = 10000 

1. Empirical mean and standard deviation for each variable,
   plus standard error of the mean:

         Mean     SD Naive SE Time-series SE
beta0 -0.7203 0.1794 0.001036       0.002251
beta1  0.4081 0.2536 0.001464       0.003242

2. Quantiles for each variable:

          2.5%     25%     50%     75%   97.5%
beta0 -1.07439 -0.8398 -0.7189 -0.5994 -0.3731
beta1 -0.09109  0.2384  0.4090  0.5791  0.9091</code></pre>
</div>
</div>
</div>
<div id="tabset-13-2">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Inference for Stan model: modeleStanL.
3 chains, each with iter=11500; warmup=1500; thin=1; 
post-warmup draws per chain=10000, total post-warmup draws=30000.

         mean se_mean   sd    2.5%     25%     50%     75%   97.5% n_eff Rhat
beta0   -0.72    0.00 0.18   -1.07   -0.84   -0.72   -0.60   -0.38  9980    1
beta1    0.40    0.00 0.25   -0.09    0.23    0.41    0.58    0.90 10100    1
lp__  -180.11    0.01 0.99 -182.76 -180.49 -179.80 -179.41 -179.14 11447    1

Samples were drawn using NUTS(diag_e) at Tue Feb 27 00:42:06 2024.
For each parameter, n_eff is a crude measure of effective sample size,
and Rhat is the potential scale reduction factor on split chains (at 
convergence, Rhat=1).</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="grandeurs-dérivées" class="slide level2">
<h2>Grandeurs dérivées</h2>
<p>Il est possible d’estimer d’autres grandeurs à partir des simulations :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a></a><span class="co"># Mise en commun des simulations</span></span>
<span id="cb70-2"><a></a>modLJ_csim <span class="ot">&lt;-</span> <span class="fu">as.mcmc</span>(<span class="fu">do.call</span>(rbind, modLJ_sim))</span>
<span id="cb70-3"><a></a><span class="co"># probabilité de guérison, placebo</span></span>
<span id="cb70-4"><a></a>p0 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(<span class="sc">-</span>modLJ_csim[,<span class="st">"beta0"</span>]))</span>
<span id="cb70-5"><a></a><span class="co"># probabilité de guérison, crème</span></span>
<span id="cb70-6"><a></a>p1 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(<span class="sc">-</span>(modLJ_csim[,<span class="st">"beta0"</span>]<span class="sc">+</span>modLJ_csim[,<span class="st">"beta1"</span>])))</span>
<span id="cb70-7"><a></a><span class="co"># Probabilité a posteriori que crème&gt;placebo</span></span>
<span id="cb70-8"><a></a>(Psup <span class="ot">&lt;-</span> <span class="fu">mean</span>(p1<span class="sc">&gt;</span>p0)) <span class="co"># équivalent à mean(modLJ_csim[,"beta1"]&gt;0)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9458</code></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a></a><span class="co"># Absolute Risk Difference</span></span>
<span id="cb72-2"><a></a>ARD <span class="ot">&lt;-</span> p1<span class="sc">-</span>p0 ; <span class="fu">mean</span>(ARD)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.09464863</code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a></a><span class="co"># RR</span></span>
<span id="cb74-2"><a></a>RR <span class="ot">&lt;-</span> p1<span class="sc">/</span>p0 ; <span class="fu">mean</span>(RR)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.307047</code></pre>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a></a><span class="co"># OR</span></span>
<span id="cb76-2"><a></a>OR <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">exp</span>(modLJ_csim[,<span class="st">"beta1"</span>])) <span class="co"># équivalent à mean((p1/(1-p1))/(p0/(1-p0)))</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="distribution-a-posteriori-1" class="slide level2">
<h2>Distribution a posteriori</h2>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><a href="Bayes_files/figure-revealjs/AgrAgrLogitMCMCJFig-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-27"><img data-src="Bayes_files/figure-revealjs/AgrAgrLogitMCMCJFig-1.png" style="width:95.0%"></a></p>
</figure>
</div>
</div>
</div>
</section></section>
<section>
<section id="comparaison-de-2-traitements-modèles-hiérarchiques" class="title-slide slide level1 center">
<h1>Comparaison de 2 traitements : modèles hiérarchiques</h1>

</section>
<section id="données-1" class="slide level2 smaller">
<h2>Données</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Centre</th>
<th style="text-align: left;">Traitement</th>
<th style="text-align: right;">Succès</th>
<th style="text-align: right;">Échecs</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;">Crème</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">25</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: left;">Placebo</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">27</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2</td>
<td style="text-align: left;">Crème</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: left;">Placebo</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3</td>
<td style="text-align: left;">Crème</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="even">
<td style="text-align: left;">3</td>
<td style="text-align: left;">Placebo</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">12</td>
</tr>
<tr class="odd">
<td style="text-align: left;">4</td>
<td style="text-align: left;">Crème</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">14</td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td style="text-align: left;">Placebo</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">16</td>
</tr>
</tbody>
</table>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Centre</th>
<th style="text-align: left;">Traitement</th>
<th style="text-align: right;">Succès</th>
<th style="text-align: right;">Échecs</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">5</td>
<td style="text-align: left;">Crème</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">11</td>
</tr>
<tr class="even">
<td style="text-align: left;">5</td>
<td style="text-align: left;">Placebo</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">12</td>
</tr>
<tr class="odd">
<td style="text-align: left;">6</td>
<td style="text-align: left;">Crème</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="even">
<td style="text-align: left;">6</td>
<td style="text-align: left;">Placebo</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="odd">
<td style="text-align: left;">7</td>
<td style="text-align: left;">Crème</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">7</td>
<td style="text-align: left;">Placebo</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">8</td>
<td style="text-align: left;">Crème</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">8</td>
<td style="text-align: left;">Placebo</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>

<aside><div>
<p>source : Agresti 2002, Categorical Data Analysis</p>
</div></aside></section>
<section id="format-des-données-pour-lanalyse" class="slide level2">
<h2>Format des données pour l’analyse</h2>
<div class="columns">
<div class="column" style="width:30%;">
<div class="cell">
<div class="cell-output-display">
<table>
<thead>
<tr class="header">
<th style="text-align: center;">c</th>
<th style="text-align: center;">t</th>
<th style="text-align: center;">y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="odd">
<td style="text-align: center;">8</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td style="text-align: center;">3</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="odd">
<td style="text-align: center;">7</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: center;">2</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="odd">
<td style="text-align: center;">2</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: center;">4</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div><div class="column" style="width:70%;">
<dl>
<dt>c</dt>
<dd>
<p>Identifiant du centre (de 1 à 8)</p>
</dd>
<dt>t</dt>
<dd>
<p>Identifiant du traitement (0 : placebo, 1 : crème)</p>
</dd>
<dt>y</dt>
<dd>
<p>identifiant de la guérison (0 : non, 1 : oui)</p>
</dd>
</dl>
</div>
</div>
</section>
<section id="stratégies-danalyse" class="slide level2">
<h2>Stratégies d’analyse</h2>
<ul>
<li><p>Ignorer le centre : précision ↑, mais risque de biais</p></li>
<li><p>Estimer un effet par centre : sans biais mais précision ↓</p></li>
<li><p>Modèle hiérarchique</p>
<ul>
<li><p>Les effets centre ont 1 distribution commune (dépendance d’1 paramètre sur les autres)</p></li>
<li><p>L’effet de chaque centre bénéficie de l’information des autres centres via les hyper-paramètres</p></li>
<li><p><span class="math inline">\(\textrm{logit}(P)= \beta_{0c} + \beta_{1c} t\)</span> avec <span class="math inline">\(\beta_{jc} \sim \textrm{norm}(\mu_j,\sigma)\)</span></p></li>
</ul></li>
</ul>
</section>
<section id="code" class="slide level2">
<h2>Code</h2>
<div class="panel-tabset">
<ul id="tabset-14" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-14-1">JAGS</a></li><li><a href="#tabset-14-2">Stan</a></li></ul>
<div class="tab-content">
<div id="tabset-14-1">
<div class="cell">
<div class="sourceCode cell-code" id="cb77" data-code-line-numbers="3-6|7-10|11-14|15-16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a></a>modeleHLJ <span class="ot">&lt;-</span> <span class="st">" </span></span>
<span id="cb77-2"><a></a><span class="st">  model {</span></span>
<span id="cb77-3"><a></a><span class="st">    for (i in 1:nbsuj) {                                 # N patients</span></span>
<span id="cb77-4"><a></a><span class="st">      y[i] ~ dbern(theta[i])                             # Vraisemblance, selon un ...</span></span>
<span id="cb77-5"><a></a><span class="st">      theta[i] = ilogit(beta0[c[i]] + beta1[c[i]]*t[i])  # modèle logistique, coefficents aléatoires </span></span>
<span id="cb77-6"><a></a><span class="st">    }</span></span>
<span id="cb77-7"><a></a><span class="st">    for (j in 1:nbcentres) {        # N centres   </span></span>
<span id="cb77-8"><a></a><span class="st">      beta0[j] ~ dnorm(mu0,prec0)   # A prioris pour beta0 (autant qu'il y a de centres)</span></span>
<span id="cb77-9"><a></a><span class="st">      beta1[j] ~ dnorm(mu1,prec1)   # A prioris pour beta1 (autant qu'il y a de centres)</span></span>
<span id="cb77-10"><a></a><span class="st">    }</span></span>
<span id="cb77-11"><a></a><span class="st">    mu0 ~ dnorm(0, 1/100^2)      # a prioris pour les hyper-paramètres</span></span>
<span id="cb77-12"><a></a><span class="st">    mu1 ~ dnorm(0, 1/100^2)</span></span>
<span id="cb77-13"><a></a><span class="st">    prec0 ~ dgamma(0.001,0.001) </span></span>
<span id="cb77-14"><a></a><span class="st">    prec1 ~ dgamma(0.001,0.001) </span></span>
<span id="cb77-15"><a></a><span class="st">    sig0 = sqrt(1/prec0)         # calcul de l'écart-type à partir de la précision</span></span>
<span id="cb77-16"><a></a><span class="st">    sig1 = sqrt(1/prec1)</span></span>
<span id="cb77-17"><a></a><span class="st">  } "</span> </span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-14-2">
<p>Stan adpaté aux modèles complexes, mais avec syntaxe peu intuitive. Manuel de Stan sur ce type de modèle : <a href="https://mc-stan.org/docs/stan-users-guide/hierarchical-logistic-regression.html" class="uri">https://mc-stan.org/docs/stan-users-guide/hierarchical-logistic-regression.html</a></p>
<p>Packages pour générer du code Stan avec une syntaxe similaire à R :</p>
<ul>
<li><p><code>rstanarm</code> : modèles précompilés (gain de temps)</p></li>
<li><p><code>brms</code> : pas de précompilation, ce qui permet plus de flexibilité</p></li>
</ul>
</div>
</div>
</div>
</section>
<section id="résultats-1" class="slide level2 smaller">
<h2>Résultats</h2>
<div class="cell">
<div class="cell-output-display">
<table>
<colgroup>
<col style="width: 20%">
<col style="width: 18%">
<col style="width: 16%">
<col style="width: 18%">
<col style="width: 26%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Coefficient</th>
<th style="text-align: right;">Taille Centre</th>
<th style="text-align: right;">log-OR brut</th>
<th style="text-align: right;">log-OR estimé</th>
<th style="text-align: center;">95 % HDI</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(\beta_1(c_1)\)</span></td>
<td style="text-align: right;">73</td>
<td style="text-align: right;">0.1723</td>
<td style="text-align: right;">0.6400</td>
<td style="text-align: center;">(-0.1624 , 1.4047)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(\beta_1(c_2)\)</span></td>
<td style="text-align: right;">52</td>
<td style="text-align: right;">0.5978</td>
<td style="text-align: right;">0.7810</td>
<td style="text-align: center;">(-0.0145 , 1.5817)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(\beta_1(c_3)\)</span></td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">1.5686</td>
<td style="text-align: right;">0.9454</td>
<td style="text-align: center;">( 0.0915 , 1.8523)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(\beta_1(c_4)\)</span></td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">0.8267</td>
<td style="text-align: right;">0.7514</td>
<td style="text-align: center;">(-0.1862 , 1.7174)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(\beta_1(c_5)\)</span></td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">2.6483</td>
<td style="text-align: right;">0.9703</td>
<td style="text-align: center;">( 0.0125 , 2.1792)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(\beta_1(c_6)\)</span></td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">1.0986</td>
<td style="text-align: right;">0.7784</td>
<td style="text-align: center;">(-0.2286 , 1.8559)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(\beta_1(c_7)\)</span></td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">0.6931</td>
<td style="text-align: right;">0.7618</td>
<td style="text-align: center;">(-0.2329 , 1.8090)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(\beta_1(c_8)\)</span></td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">-1.0986</td>
<td style="text-align: right;">0.6925</td>
<td style="text-align: center;">(-0.4003 , 1.6368)</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="shrinkage-retrécissement" class="slide level2">
<h2>Shrinkage (retrécissement)</h2>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><a href="Bayes_files/figure-revealjs/HieraLogitFig-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-28"><img data-src="Bayes_files/figure-revealjs/HieraLogitFig-1.png" style="width:95.0%"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="shrinkage-retrécissement-1" class="slide level2">
<h2>Shrinkage (retrécissement)</h2>
<div class="columns">
<div class="column" style="width:20%;">
<p><a href="Bayes_files/img/pressure.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-29"><img data-src="Bayes_files/img/pressure.svg" class="no-lightbox" style="width:85.0%"></a></p>
</div><div class="column" style="width:80%;">
<ul>
<li><p>Modèle hiérarchique (e.g.&nbsp;multiniveaux, à effets aléatoires)</p></li>
<li><p>Estimations de bas niveau se rapprochent du(des) mode(s) du groupe (e.g.&nbsp;log-ORs des centres)</p>
<ul>
<li><p>↓ d’estimations extrêmes (<em>outliers</em>)</p></li>
<li><p>Réduit le risque de <span style="color:#ED4F33">faux positifs</span></p></li>
<li><p>Estimations plus précises pour les petits groupes (<em>borrowing strength</em>)</p></li>
</ul></li>
</ul>
</div>
</div>
</section>
<section id="deviance-information-criterion" class="slide level2">
<h2>Deviance Information Criterion</h2>
<div class="columns">
<div class="column" style="width:20%;">
<p><a href="Bayes_files/img/balance.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-30"><img data-src="Bayes_files/img/balance.svg" class="no-lightbox" style="width:85.0%"></a></p>
</div><div class="column" style="width:80%;">
<ul>
<li><p>Mesure de l’ajustement des données implémentée depuis BUGS</p></li>
<li><p>DIC = Déviance D = <span class="math inline">\(-2 \log\left(\color{#ED4F33}{P(D|\theta)}\right)\)</span> pénalisée de la complexité</p></li>
<li><p>Le modèle avec le DIC le plus faible est favorisé</p></li>
<li><p>D’autres approches plus récentes (wAIC, LOO) adoptées pour Stan mais non implémentées en routine pour JAGS</p></li>
</ul>
</div>
</div>
</section>
<section id="comparaison-de-modèles-dic" class="slide level2">
<h2>Comparaison de modèles : DIC</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a></a><span class="co"># Modèle sans effet centre</span></span>
<span id="cb78-2"><a></a>(dic0 <span class="ot">&lt;-</span> <span class="fu">dic.samples</span>(modLJ,<span class="at">n.iter =</span> <span class="dv">10000</span>))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mean deviance:  360.2 
penalty 1.973 
Penalized deviance: 362.2 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a></a><span class="co"># Modèle avec effet centre (hiérarchique)</span></span>
<span id="cb80-2"><a></a>(dic1 <span class="ot">&lt;-</span> <span class="fu">dic.samples</span>(modLHF,<span class="at">n.iter =</span> <span class="dv">10000</span>))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mean deviance:  285.1 
penalty 9.628 
Penalized deviance: 294.8 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a></a><span class="co"># Différences</span></span>
<span id="cb82-2"><a></a><span class="fu">diffdic</span>(dic0, dic1)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Difference: 67.43693
Sample standard error: 18.65602</code></pre>
</div>
</div>
</section></section>
<section>
<section id="test-dhypothèses" class="title-slide slide level1 center">
<h1>Test d’hypothèses</h1>

</section>
<section id="approche-fréquentiste-p-value" class="slide level2">
<h2>Approche fréquentiste : p-value</h2>
<p>Probabilité d’obtenir un effet ≥ à celui observé si l’hypothèse testée est vraie et si <span style="color:#ED4F33">les conditions de validité utilisées pour son calcul sont respectées</span><sup>1</sup></p>
<ul>
<li>Introduite par Karl Pearson en 1900</li>
<li>Popularisée par Ronald Fisher en 1925</li>
</ul>
<aside><ol class="aside-footnotes"><li id="fn2"><p>par exemple, échantillonnage aléatoire parfait (pas de biais de sélection), modèle sous-jacent correctement spécifié (linéarité, additivité, distribution des erreurs, absence de facteur de confusion non ajusté, absence d’intermédiaires entre l’exposition et la réponse …), pas de violation de protocole, erreurs de mesure et sélection du modèle parfaitement pris en compte…</p></li></ol></aside></section>
<section class="slide level2">

<p>Pour Ronald Fisher, p est un <span style="color:#F5B12E">index informel</span> pour mesurer l’écart entre les données et l’hypothèse testée.</p>
<p><br>
<em><span style="color:#8B8682">If P is <span style="color:#F5B12E">between .1 and .9 there is certainly no reason to suspect the hypothesis tested</span>. If it is below .02 it is strongly indicated that the hypothesis fails to account for the whole of the facts.</span></em> [1925]</p>
<p><em><span style="color:#8B8682">The value for which <span style="color:#F5B12E">P=0.05</span>, or 1 in 20, is 1.96 or nearly 2; it is <span style="color:#F5B12E">convenient</span> to take this point as a limit in judging whether a deviation ought to be considered significant or not.</span></em> [1925]</p>
<p><em><span style="color:#F5B12E">no scientific worker has a fixed level of significance</span> <span style="color:#8B8682">at which from year to year, and in all circumstances, he rejects hypotheses; he rather gives his mind to each particular case in the light of his evidence and his ideas</span></em> [1956]</p>
</section>
<section id="le-test-dhyptothèse-de-neyman-pearson" class="slide level2">
<h2>Le test d’hyptothèse de Neyman-Pearson</h2>
<table style="width:99%;">
<colgroup>
<col style="width: 28%">
<col style="width: 35%">
<col style="width: 35%">
</colgroup>
<thead>
<tr class="header">
<th rowspan="2" style="text-align: right;">Résultat de l’expérience</th>
<th colspan="2" style="text-align: center;">La vérité</th>
</tr>
<tr class="odd">
<th style="text-align: center;"><span class="math inline">\(H_0\)</span> est vraie</th>
<th style="text-align: center;"><span class="math inline">\(H_0\)</span> est fausse</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">Rejet de <span class="math inline">\(H_0\)</span></td>
<td style="text-align: center;">Erreur de type I (<span class="math inline">\(\alpha\)</span>)</td>
<td style="text-align: center;">Puissance (<span class="math inline">\(1-\beta\)</span>)</td>
</tr>
<tr class="even">
<td style="text-align: right;">Conservation de <span class="math inline">\(H_0\)</span></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">Erreur de type II (<span class="math inline">\(\beta\)</span>)</td>
</tr>
</tbody>
</table>
<ul>
<li><p>Approche décisionnelle, avec <span class="math inline">\(\alpha\)</span> et <span class="math inline">\(\beta\)</span> fixés à l’avance</p></li>
<li><p>Conçu pour la standardisation industrielle et le contrôle qualité</p></li>
</ul>
</section>
<section class="slide level2">

<p>Pour Neyman et Pearson, p ne permet pas de juger de la force de preuve mais fournit une <span style="color:#F5B12E">règle de décision objective</span></p>
<p><br>
<em><span style="color:#8B8682">We are inclined to think that <span style="color:#F5B12E">as far as a particular hypothesis is concerned</span>, <span style="color:#F5B12E">no test</span> based upon a theory of probability <span style="color:#F5B12E">can by itself provide any valuable evidence</span> of the truth or falsehood of a hypothesis. But we may look at the purpose of tests from another viewpoint. Without hoping to know whether each separate hypothesis is true or false, we may search for <span style="color:#F5B12E">rules to govern our behaviour</span> with regard to them, in following which we insure that, <span style="color:#F5B12E">in the long run</span> of experience, <span style="color:#F5B12E">we shall not often be wrong.</span></span></em> [1933]</p>
</section>
<section id="probabilité-de-préférer-le-traitement-a" class="slide level2">
<h2>Probabilité de préférer le traitement A</h2>
<ul>
<li><p>2 traitements A et B testés tous 2 sur 6 patients</p></li>
<li><p>1 patient préfère B, 5 patients préfèrent A</p></li>
</ul>
<div class="fragment">
<p>Peut-on en conclure que P(A préféré) &gt; P(B préféré) ?</p>

</div>
<aside><div>
<p>Tiré de Goodman 1999, Toward Evidence-Based Medical Statistics, Ann Intern Med</p>
</div></aside></section>
<section id="approche-fréquentiste" class="slide level2">
<h2>Approche fréquentiste</h2>
<ul>
<li><p>Revient à tester <span class="math inline">\(H_0\)</span> : P(A préféré) = <span class="math inline">\(\theta\)</span> = 0.5</p></li>
<li><p>Probabilité d’observer une difference <span class="math inline">\(\geq\)</span> que celle observée, si <span class="math inline">\(H_0\)</span> vraie</p></li>
<li><p>La p-value dépend des <span style="color:#ED4F33">intentions</span> <span class="math inline">\(I\)</span> de l’expérimentateur</p></li>
<li><p>p-value = <span class="math inline">\(P(D_{\theta, I} \geq D_{observé} | \theta, I)\)</span></p></li>
</ul>
</section>
<section id="intention-de-fixer-n-à-6" class="slide level2">
<h2>Intention de fixer N à 6</h2>
<p>Résultats plus extrêmes que 5/6 préférant A possibles :</p>
<ul>
<li><p>A préféré 6 fois, AAAAAA, avec probabilité <span class="math inline">\(P(6A) = \left(\frac{1}{2}\right)^6\)</span> sous <span class="math inline">\(H_0\)</span></p></li>
<li><p>A préféré 0 fois : probabilité égale à P(6A)</p></li>
<li><p>préféré 5 fois, AAAAAB ou AAAABA ou …, <span class="math inline">\(P(5A) = 6 \left(\frac{1}{2}\right)^1 \left(\frac{1}{2}\right)^5\)</span></p></li>
<li><p>A préféré 1 fois : probabilité égale à P(5A)</p></li>
</ul>
<p>p-value = <span class="math inline">\({\small P(6A|\theta=0.5)+P(5A|\theta=0.5)+P(1A|\theta=0.5)+P(0A|\theta=0.5)}\)</span> = <span class="math inline">\(\left(\frac{1}{2}\right)^6 + 6 \left(\frac{1}{2}\right)^5 \left(\frac{1}{2}\right)^1 + 6 \left(\frac{1}{2}\right)^1 \left(\frac{1}{2}\right)^5 + \left(\frac{1}{2}\right)^6\)</span> = 0.21875</p>
</section>
<section id="intention-de-sarrêter-au-1er-patient-préférant-b-ou-à-n6" class="slide level2">
<h2>Intention de s’arrêter au 1<sup>er</sup> patient préférant B ou à N=6</h2>
<ul>
<li><p><span class="math inline">\(P(6A) = \left(\frac{1}{2}\right)^6\)</span></p></li>
<li><p>A préféré 5 fois implique obligatoirement AAAAAB, <span class="math inline">\(P(5A)=P(6A)\)</span></p></li>
<li><p>A préféré &lt; 5 fois impossible</p></li>
</ul>
<p>p-value = <span class="math inline">\(\left(\frac{1}{2}\right)^6 + \left(\frac{1}{2}\right)^5 \left(\frac{1}{2}\right)^1\)</span> = 0.03125</p>
<p>Impact de l’intention : principe de vraisemblance<sup>1</sup> violé.</p>
<aside><ol class="aside-footnotes"><li id="fn3"><p>Les vraisemblances de D sous les hypothèses contiennent toute l’information qui peut être extraite des données</p></li></ol></aside></section>
<section id="le-facteur-de-bayes" class="slide level2 smaller">
<h2>Le facteur de Bayes</h2>
<div class="columns">
<div class="column" style="width:45%;">
<p>Sous le principe de vraisemblance, le facteur de Bayes permet de choisir entre deux modèles.</p>
<p>Pour <span class="math inline">\(H_1\)</span> vs <span class="math inline">\(H_0\)</span> :</p>
<p><span class="math display">\[BF_{10} = \frac{P\left(D|H_1\right)}{P\left(D|H_0\right)}\]</span></p>
</div><div class="column" style="width:55%;">
<p>Selon Jeffreys :</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;"><span class="math inline">\(BF_{10}\)</span></th>
<th style="text-align: left;">Force de la preuve contre <span class="math inline">\(H_0\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">&gt; 100</td>
<td style="text-align: left;">Décisive</td>
</tr>
<tr class="even">
<td style="text-align: center;">32 - 100</td>
<td style="text-align: left;">Très forte</td>
</tr>
<tr class="odd">
<td style="text-align: center;">10 - 32</td>
<td style="text-align: left;">Forte</td>
</tr>
<tr class="even">
<td style="text-align: center;">3,2 - 10</td>
<td style="text-align: left;">Substantielle</td>
</tr>
<tr class="odd">
<td style="text-align: center;">1 - 3,2</td>
<td style="text-align: left;">Ne méritant pas plus que sa mention</td>
</tr>
</tbody>
</table>
<p>BF peut être approché par le BIC.</p>
</div>
</div>
</section>
<section id="retour-à-lexemple" class="slide level2">
<h2>Retour à l’exemple</h2>
<p><span class="math inline">\(H_0\)</span> : P(A préféré)=1/2, <span class="math inline">\(H_1\)</span> : P(A préféré)=5/6.</p>
<p><span class="math display">\[BF_{exp_1} = \frac{6 \left(\frac{1}{6}\right)^1 \left(\frac{5}{6}\right)^5}{6 \left(\frac{1}{2}\right)^1 \left(\frac{1}{2}\right)^5} = 4,29\]</span> <span class="math display">\[BF_{exp_2} = BF_{exp_1} = \frac{\left(\frac{1}{6}\right)^1 \left(\frac{5}{6}\right)^5}{\left(\frac{1}{2}\right)^1 \left(\frac{1}{2}\right)^5} = 4,29\]</span> Petit niveau de preuve en faveur de <span class="math inline">\(H_1\)</span> (et respect du principe de vraisemblance).</p>
</section>
<section id="plus-formellement-approche-conjuguée" class="slide level2">
<h2>Plus formellement : approche conjuguée</h2>
<p>Sous <span class="math inline">\(H_0\)</span>, <span class="math inline">\(\color{#ED4F33}{P(D|\theta_{H_0})} = \theta_{H_0}^{k} (1-\theta_{H_0})^{n-k} = \left(\frac{1}{2}\right)^5 \left(\frac{1}{2}\right)^1\)</span></p>
<p><br>
Sous <span class="math inline">\(H_1\)</span>, <span class="math inline">\(\theta_{H_1}\)</span> peut prendre n’importe quelle valeur.</p>
<p>Avec <span class="math inline">\(\color{#F5B12E}{P(\theta)}=\textrm{beta}(a,b)\)</span>,</p>
<p><span class="math display">\[BF = \frac{\textrm{B}(k+a,n-k+b)/\textrm{B}(a,b)}{\theta_{H_0}^{k} (1-\theta_{H_0})^{n-k}}\]</span></p>

<aside><div>
<p><span class="math inline">\(\textrm{B(a,b)} = \frac{\Gamma(a)\Gamma(b)}{\Gamma(a+b)}\)</span></p>
</div></aside></section>
<section id="application" class="slide level2">
<h2>Application</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a></a>BFprop <span class="ot">&lt;-</span> <span class="cf">function</span>(k,n,ph0,a,b) {</span>
<span id="cb84-2"><a></a>      vh0 <span class="ot">&lt;-</span> ph0<span class="sc">^</span>k<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>ph0)<span class="sc">^</span>(n<span class="sc">-</span>k)</span>
<span id="cb84-3"><a></a>      vh1 <span class="ot">&lt;-</span> <span class="fu">exp</span>( <span class="fu">lbeta</span>(k<span class="sc">+</span>a,n<span class="sc">-</span>k<span class="sc">+</span>b) <span class="sc">-</span> <span class="fu">lbeta</span>(a,b) )</span>
<span id="cb84-4"><a></a>      <span class="fu">return</span>(vh1<span class="sc">/</span>vh0)</span>
<span id="cb84-5"><a></a>}</span>
<span id="cb84-6"><a></a></span>
<span id="cb84-7"><a></a><span class="fu">BFprop</span>(<span class="at">k=</span><span class="dv">5</span>, <span class="at">n=</span><span class="dv">6</span>, <span class="at">ph0=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">a=</span><span class="dv">1</span>, <span class="at">b=</span><span class="dv">1</span>) <span class="co"># a priori uniforme</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.52381</code></pre>
</div>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a></a><span class="fu">BFprop</span>(<span class="at">k=</span><span class="dv">5</span>, <span class="at">n=</span><span class="dv">6</span>, <span class="at">ph0=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">a=</span><span class="fl">0.5</span>, <span class="at">b=</span><span class="fl">0.5</span>) <span class="co"># a priori de Jeffreys</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.3125</code></pre>
</div>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a></a><span class="fu">BFprop</span>(<span class="at">k=</span><span class="dv">5</span>, <span class="at">n=</span><span class="dv">6</span>, <span class="at">ph0=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">a=</span><span class="fl">0.1</span>, <span class="at">b=</span><span class="fl">0.1</span>) <span class="co"># a priori type Haldane</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5092147</code></pre>
</div>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a></a><span class="fu">BFprop</span>(<span class="at">k=</span><span class="dv">5</span>, <span class="at">n=</span><span class="dv">6</span>, <span class="at">ph0=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">a=</span><span class="fl">0.01</span>, <span class="at">b=</span><span class="fl">0.01</span>) <span class="co"># encore plus extrême</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0624439</code></pre>
</div>
</div>
</section>
<section id="importance-du-choix-de-la-priori" class="slide level2 smaller">
<h2>Importance du choix de l’a priori</h2>
<ul>
<li><p>Sauf cas extrêmes, <span class="math inline">\(\color{#2E2963}{P(\theta|D)}\)</span> peu influencé par le choix de <span class="math inline">\(\color{#F5B12E}{P(\theta)}\)</span></p></li>
<li><p>Mais le BF l’est :</p>
<ul>
<li><p>A priori trop vague : <span class="math inline">\(P(D|H_1) \approx 0\)</span> <span class="math inline">\(\forall \theta\)</span> <span class="math inline">\(\Rightarrow\)</span> <span class="math inline">\(H_0\)</span> favorisé</p></li>
<li><p>Valeur observée proche de <span class="math inline">\(H_0\)</span> : <span class="math inline">\(H_0\)</span> favorisé même si estimation imprécise<sup>1</sup></p></li>
</ul></li>
<li><p>Certains bayésiens recommandent plutôt des approches de type région d’équivalence</p>
<ul>
<li><p>Accepter <span class="math inline">\(H_0\)</span> si l’HDI de <span class="math inline">\(\theta\)</span> est inclus dans la région</p></li>
<li><p>Rejetter <span class="math inline">\(H_0\)</span> si en dehors</p></li>
<li><p>Non concluant si l’HDI recoupe la région</p></li>
</ul></li>
</ul>
<aside><ol class="aside-footnotes"><li id="fn4"><p>3/6 patients préfèrent A <span class="math inline">\(\Rightarrow\)</span> BF=2.2 en faveur de <span class="math inline">\(H_0\)</span> avec a priori uniforme</p></li></ol></aside></section>
<section id="le-paradoxe-de-lindley" class="slide level2 smaller">
<h2>Le “paradoxe” de Lindley</h2>
<p>Tests d’hypothèses fréquentiste bayésien peuvent diverger.</p>
<p>Exemple : valeurs du <span class="math inline">\(BF_{10}\)</span><sup>1</sup> pour un test <span class="math inline">\(t\)</span> donnant <span class="math inline">\(p=0.05\)</span> en fréquentiste, selon la taille d’échantillon</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><a href="Bayes_files/figure-revealjs/LindleyParadox-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-31"><img data-src="Bayes_files/figure-revealjs/LindleyParadox-1.png" style="width:95.0%"></a></p>
</figure>
</div>
</div>
</div>
<p>Malgré la significativité statistique,</p>
<ul>
<li><p>pour auncune taille d’échantillon <span class="math inline">\(BF_{10} &gt; 3.2\)</span> (<span class="math inline">\(H_1\)</span> jamais confirmée)</p></li>
<li><p><span style="color:#ED4F33">à partir de <span class="math inline">\(n \approx 1180\)</span> patients par groupe, <span class="math inline">\(BF_{10} &gt; \frac{1}{3.2}\)</span> (<span class="math inline">\(H_0\)</span> confirmée)</span>.</p></li>
</ul>
<aside><ol class="aside-footnotes"><li id="fn5"><p>En employant la fonction <code>ttest.tstat</code> du package <code>BayesFactor</code> avec son a priori par défaut</p></li></ol></aside></section>
<section id="le-test-dhypothèse-comme-rituel" class="slide level2">
<h2>Le test d’hypothèse comme rituel</h2>
<p>“Null ritual” : mélange des idées de Fisher et Neyman-Pearson :</p>
<ol type="1">
<li><p>Définir une <span class="math inline">\(H_0\)</span> d’absence de différence, sans préciser les prédictions de l’hypothèse de recherche ou une hypothèse alternative substantive</p></li>
<li><p>Utiliser 5 % comme seuil de rejet de <span class="math inline">\(H_0\)</span>.</p></li>
<li><p>Toujours utiliser cette procédure.</p></li>
</ol>

<aside><div>
<p><em><span style="color:#8B8682">Elements of social rituals include (a) the <span style="color:#ED4F33">repetition of the same action</span>, (b) a <span style="color:#ED4F33">focus on special numbers</span> or colors, (c) fears about serious <span style="color:#ED4F33">sanctions for rule violations</span>, and (d) wishful thinking and delusions that virtually <span style="color:#ED4F33">eliminate critical thinking</span></span></em> (Gigerenzer et al.&nbsp;2004)</p>
</div></aside></section>
<section id="les-problèmes-avec-la-p-value" class="slide level2 smaller">
<h2>Les problèmes avec la p-value</h2>
<ul>
<li><p>Ne permet pas de quantifier les preuves en faveur de <span class="math inline">\(H_0\)</span>, mais…</p></li>
<li><p>Mal interprétée. Les résultats statistiquement non significatifs sont notamment interprétés comme preuve d’équivalence (i.e.&nbsp;confirmation de <span class="math inline">\(H_0\)</span>)</p>
<ul>
<li><p>Déjà problématique pour l’efficacité<sup>1</sup></p></li>
<li><p>Mais plus encore pour les risques<sup>2</sup></p></li>
</ul></li>
<li><p>Ne distingue pas taille d’effet et précision (telle qu’employée classiquement)</p></li>
<li><p>Peut surestimer le degré de preuve</p></li>
<li><p>Ne respecte pas le principe de vraisemblance (dépend de données imaginaires, car quantifie la probabilité de l’observé <em>ou plus extrême</em> - cela la rend particulièrement vulnérable à des manipulations, tels que changements de protocole ou de plan d’analyse post-hoc)</p></li>
</ul>
<aside><ol class="aside-footnotes"><li id="fn6"><p>e.g.&nbsp;<a href="https://www.fda.gov/news-events/press-announcements/fda-approves-new-treatment-pompe-disease">communication FDA</a> sur un médicament avec une taille d’effet cliniquement pertinente mais <span class="math inline">\(p=0.06\)</span> : <em><span style="color:#8B8682">Treatment (…) similar to the improvement seen with the other therapy</span></em></p></li><li id="fn7"><p>e.g.&nbsp;article concluant que <em><span style="color:#8B8682">exposure compared with no exposure was not associated with autism spectrum disorder</span></em> sur la base d’un HR de 1.61 [95% CI, 0.997-2.59] (<a href="https://doi.org/10.1001/jama.2017.3415">10.1001/jama.2017.3415</a>)</p></li></ol></aside></section>
<section id="asa-statement-on-p-values" class="slide level2 smaller">
<h2>ASA statement on p-values</h2>
<ol type="1">
<li><p><em><span style="color:#8B8682">P-values can indicate how incompatible the data are with a specified statistical model.</span></em></p></li>
<li><p><em><span style="color:#8B8682">P-values do not measure the probability that the studied hypothesis is true, or the probability that the data were produced by random chance alone.</span></em></p></li>
<li><p><em><span style="color:#8B8682">Scientific conclusions and business or policy decisions should not be based only on whether a p-value passes a specific threshold.</span></em></p></li>
<li><p><em><span style="color:#8B8682">Proper inference requires full reporting and transparency.</span></em></p></li>
<li><p><em><span style="color:#8B8682">A p-value, or statistical significance, does not measure the size of an effect or the importance of a result.</span></em></p></li>
<li><p><em><span style="color:#8B8682">By itself, a p-value does not provide a good measure of evidence regarding a model or hypothesis.</span></em></p></li>
</ol>

<aside><div>
<p><a href="https://www.amstat.org/asa/files/pdfs/P-ValueStatement.pdf" class="uri">https://www.amstat.org/asa/files/pdfs/P-ValueStatement.pdf</a> (2016-03-07)</p>
</div></aside></section></section>
<section>
<section id="bilan" class="title-slide slide level1 center">
<h1>Bilan</h1>

</section>
<section id="pratiques" class="slide level2 smaller">
<h2>Pratiques</h2>
<ul>
<li><p><span style="color:#F5B12E">Inférence</span> Bayésienne et Fréquentiste donnent des résultats <span style="color:#F5B12E">similaires</span> (généralement)</p></li>
<li><p><span style="color:#F5B12E">Test d’hypothèse</span> Bayésien et Fréquentiste peuvent <span style="color:#ED4F33">différer</span></p></li>
<li><p>Si possible, privilégier l’estimation des paramètres et de l’incertitude aux tests</p></li>
<li><p>Choix de l’approche</p>
<ul>
<li><p><span class="math inline">\(n\)</span> petit, modèles complexes : Bayésien parfois la seule option</p></li>
<li><p><em>Innovative trial designs</em> (<em>master protocols, external controls, adaptative trials</em>) : place plus importante du Bayésien</p></li>
</ul></li>
<li><p>Le choix de l’a priori n’est pas nécessairement non informatif</p></li>
<li><p>Tendance émergente à considérer <em>weakly informative</em> &gt; <em>uninformative</em></p></li>
<li><p>L’élicitation et intégration des a prioris (e.g.&nbsp;Si des données historiques existent, avis d’experts, …) reste un champ de recherche actif</p></li>
<li><p>Ne pas négliger les analyses de sensibilité</p></li>
</ul>
</section>
<section id="pourquoi-la-statistique-bayésienne" class="slide level2">
<h2>Pourquoi la statistique Bayésienne ?</h2>
<div class="columns">
<div class="column" style="width:50%;">
<ul>
<li><p>Intuitif</p></li>
<li><p>Flexible</p></li>
<li><p>Répond aux bonnes questions (e.g.&nbsp;<span class="math inline">\(P(H_0)\)</span>)</p></li>
<li><p><span class="math inline">\(\theta\)</span> complexe</p></li>
<li><p><span class="math inline">\(n\)</span> petit</p></li>
<li><p><em>sparse data bias</em></p></li>
<li><p>Efficient (et donc éthique) si information a priori existante</p></li>
</ul>
</div><div class="column" style="width:50%;">
<ul>
<li><p>Contrôle des faux positifs</p></li>
<li><p>Modélisation et intégration des biais</p></li>
<li><p>Gestion d’<em>outliers</em> par modèles robustes</p></li>
<li><p>Gestion de la multiplicité ou de l’arrêt optionnel</p></li>
<li><p>Gestion des prédicteurs multiples</p></li>
<li><p>Approche intégrée</p></li>
</ul>
</div>
</div>
</section>
<section id="une-popularité-croissante" class="slide level2">
<h2>Une popularité croissante</h2>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><a href="Bayes_files/figure-revealjs/PubmedFig-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-32"><img data-src="Bayes_files/figure-revealjs/PubmedFig-1.png" style="width:95.0%"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="pour-aller-plus-loin" class="slide level2 smaller">
<h2>Pour aller plus loin</h2>
<ul>
<li><p>Livres</p>
<ul>
<li><p>Spiegelhalter et al.&nbsp;2004. Bayesian Approaches to Clinical Trials and Health-Care Evaluation. Wiley</p></li>
<li><p>Kruschke 2015. Doing Bayesian Data Analysis: A Tutorial with R, JAGS, and Stan, 2<sup>nd</sup> Edition. Elsevier</p></li>
<li><p>McElreath 2020. Statistical Rethinking: A Bayesian Course with Examples in R and STAN, 2<sup>nd</sup> Edition. Chapman and Hall/CRC</p></li>
</ul></li>
<li><p>MOOCs</p>
<ul>
<li><p>Bayesian statistics specialization sur <a href="https://www.coursera.org/specializations/bayesian-statistics">coursera</a> et d’autres cours sur la même plateforme</p></li>
<li><p>Cours sur d’autres plateformes <a href="https://www.datacamp.com/">datacamp</a>, <a href="https://www.edx.org/">ed<sub>X</sub></a>, …</p></li>
</ul></li>
<li><p>Documentation, forums, manuels des différents logiciels</p></li>
</ul>
</section>
<section id="section" class="slide level2" data-background-image="Bayes_files/img/thinker.jpg" data-background-opacity="0.1">
<h2></h2>
<p><br>
<br>
</p>
<div class="r-fit-text">
<p><strong><em><span style="color:#8B8682">Bayesian statistics is difficult in the sense</span></em></strong></p>
</div>
<div class="r-fit-text">
<p><strong><em><span style="color:#8B8682">that <span style="color:#F5B12E">thinking</span> is difficult.</span></em></strong></p>
</div>


<div class="quarto-auto-generated-content">
<div class="footer footer-default">

</div>
</div>
<aside><div>
<p>Donald A. Berry</p>
<p>‘Teaching Elementary Bayesian Statistics with Real Applications in Science’</p>
</div></aside></section></section>

    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="site_libs/revealjs/plugin/search/search.js"></script>
  <script src="site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'slide',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'fast',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1400,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        text: function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copié");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copié");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          return note.innerHTML;
        });
      }
          let selectedAnnoteEl;
          const selectorForAnnotation = ( cell, annotation) => {
            let cellAttr = 'data-code-cell="' + cell + '"';
            let lineAttr = 'data-code-annotation="' +  annotation + '"';
            const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
            return selector;
          }
          const selectCodeLines = (annoteEl) => {
            const doc = window.document;
            const targetCell = annoteEl.getAttribute("data-target-cell");
            const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
            const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
            const lines = annoteSpan.getAttribute("data-code-lines").split(",");
            const lineIds = lines.map((line) => {
              return targetCell + "-" + line;
            })
            let top = null;
            let height = null;
            let parent = null;
            if (lineIds.length > 0) {
                //compute the position of the single el (top and bottom and make a div)
                const el = window.document.getElementById(lineIds[0]);
                top = el.offsetTop;
                height = el.offsetHeight;
                parent = el.parentElement.parentElement;
              if (lineIds.length > 1) {
                const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
                const bottom = lastEl.offsetTop + lastEl.offsetHeight;
                height = bottom - top;
              }
              if (top !== null && height !== null && parent !== null) {
                // cook up a div (if necessary) and position it 
                let div = window.document.getElementById("code-annotation-line-highlight");
                if (div === null) {
                  div = window.document.createElement("div");
                  div.setAttribute("id", "code-annotation-line-highlight");
                  div.style.position = 'absolute';
                  parent.appendChild(div);
                }
                div.style.top = top - 2 + "px";
                div.style.height = height + 4 + "px";
                div.style.left = 0;
                let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
                if (gutterDiv === null) {
                  gutterDiv = window.document.createElement("div");
                  gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                  gutterDiv.style.position = 'absolute';
                  const codeCell = window.document.getElementById(targetCell);
                  const gutter = codeCell.querySelector('.code-annotation-gutter');
                  gutter.appendChild(gutterDiv);
                }
                gutterDiv.style.top = top - 2 + "px";
                gutterDiv.style.height = height + 4 + "px";
              }
              selectedAnnoteEl = annoteEl;
            }
          };
          const unselectCodeLines = () => {
            const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
            elementsIds.forEach((elId) => {
              const div = window.document.getElementById(elId);
              if (div) {
                div.remove();
              }
            });
            selectedAnnoteEl = undefined;
          };
            // Handle positioning of the toggle
        window.addEventListener(
          "resize",
          throttle(() => {
            elRect = undefined;
            if (selectedAnnoteEl) {
              selectCodeLines(selectedAnnoteEl);
            }
          }, 10)
        );
        function throttle(fn, ms) {
        let throttle = false;
        let timer;
          return (...args) => {
            if(!throttle) { // first call gets through
                fn.apply(this, args);
                throttle = true;
            } else { // all the others get throttled
                if(timer) clearTimeout(timer); // cancel #2
                timer = setTimeout(() => {
                  fn.apply(this, args);
                  timer = throttle = false;
                }, ms);
            }
          };
        }
          // Attach click handler to the DT
          const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
          for (const annoteDlNode of annoteDls) {
            annoteDlNode.addEventListener('click', (event) => {
              const clickedEl = event.target;
              if (clickedEl !== selectedAnnoteEl) {
                unselectCodeLines();
                const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
                if (activeEl) {
                  activeEl.classList.remove('code-annotation-active');
                }
                selectCodeLines(clickedEl);
                clickedEl.classList.add('code-annotation-active');
              } else {
                // Unselect the line
                unselectCodeLines();
                clickedEl.classList.remove('code-annotation-active');
              }
            });
          }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    <script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","openEffect":"zoom","descPosition":"bottom","selector":".lightbox","loop":false});
    window.onload = () => {
      lightboxQuarto.on('slide_before_load', (data) => {
        const { slideIndex, slideNode, slideConfig, player, trigger } = data;
        const href = trigger.getAttribute('href');
        if (href !== null) {
          const imgEl = window.document.querySelector(`a[href="${href}"] img`);
          if (imgEl !== null) {
            const srcAttr = imgEl.getAttribute("src");
            if (srcAttr && srcAttr.startsWith("data:")) {
              slideConfig.href = srcAttr;
            }
          }
        } 
      });

      lightboxQuarto.on('slide_after_load', (data) => {
        const { slideIndex, slideNode, slideConfig, player, trigger } = data;
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(slideNode);
        }
      });

    };
              </script>
    

</body></html>